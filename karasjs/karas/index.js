!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t=t||self).karas=e()}(this,function(){"use strict";function a(t){return(a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function f(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function r(t,e){for(var i=0;i<e.length;i++){var r=e[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function s(t,e,i){return e&&r(t.prototype,e),i&&r(t,i),t}function n(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}function o(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),i.push.apply(i,r)}return i}function h(e){for(var t=1;t<arguments.length;t++){var i=null!=arguments[t]?arguments[t]:{};t%2?o(i,!0).forEach(function(t){n(e,t,i[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):o(i).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(i,t))})}return e}function t(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&i(t,e)}function X(t){return(X=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function i(t,e){return(i=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function u(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function _(t,e){return!e||"object"!=typeof e&&"function"!=typeof e?u(t):e}function H(t,e,i){return(H="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,i){var r=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=X(t)););return t}(t,e);if(r){var n=Object.getOwnPropertyDescriptor(r,e);return n.get?n.get.call(i):n.value}})(t,e,i||t)}function Jt(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){if(!(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t)))return;var i=[],r=!0,n=!1,a=void 0;try{for(var o,s=t[Symbol.iterator]();!(r=(o=s.next()).done)&&(i.push(o.value),!e||i.length!==e);r=!0);}catch(t){n=!0,a=t}finally{try{r||null==s.return||s.return()}finally{if(n)throw a}}return i}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function te(t){return function(t){if(Array.isArray(t)){for(var e=0,i=new Array(t.length);e<t.length;e++)i[e]=t[e];return i}}(t)||function(t){if(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t))return Array.from(t)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}var G={AUTO:0,PX:1,PERCENT:2,POSITION:3,NUMBER:4,INHERIT:5,DEG:6,SIZE:7},l=function(){function t(){f(this,t),this.__x=0,this.__y=0,this.__ox=0,this.__oy=0,this.__width=0,this.__height=0,this.__prev=null,this.__next=null,this.__ctx=null,this.__defs=null,this.__parent=null,this.__computedStyle={},this.__baseLine=0,this.__virtualDom={},this.__host=null}return s(t,[{key:"__offsetX",value:function(t,e){e?this.__x+=t:this.__ox+=t}},{key:"__offsetY",value:function(t,e){e?this.__y+=t:this.__oy+=t}},{key:"__destroy",value:function(){this.__isDestroyed=!0,this.__prev=this.__next=this.__ctx=this.__defs=this.__parent=this.__host=null}},{key:"x",get:function(){return this.__x}},{key:"y",get:function(){return this.__y}},{key:"ox",get:function(){return this.__ox}},{key:"oy",get:function(){return this.__oy}},{key:"sx",get:function(){return this.x+this.ox}},{key:"sy",get:function(){return this.y+this.oy}},{key:"width",get:function(){return this.__width}},{key:"height",get:function(){return this.__height}},{key:"outerWidth",get:function(){return this.__width}},{key:"outerHeight",get:function(){return this.__height}},{key:"prev",get:function(){return this.__prev}},{key:"next",get:function(){return this.__next}},{key:"parent",get:function(){return this.__parent}},{key:"root",get:function(){return this.host?this.host.root:this.parent?this.parent.root:this.tagName&&{canvas:!0,svg:!0}.hasOwnProperty(this.tagName)?this:void 0}},{key:"host",get:function(){return this.__host?this.__host:this.parent?this.parent.host:void 0}},{key:"style",get:function(){return this.__style}},{key:"computedStyle",get:function(){return this.__computedStyle}},{key:"ctx",get:function(){return this.__ctx}},{key:"defs",get:function(){return this.__defs}},{key:"baseLine",get:function(){return this.__baseLine}},{key:"virtualDom",get:function(){return this.__virtualDom}},{key:"isDestroyed",get:function(){return this.__isDestroyed}}]),t}(),ee={CANVAS:0,SVG:1},c={}.toString;function e(e){return function(t){return c.call(t)==="[object "+e+"]"}}var d=e("Number");function p(t){return v(t)?"":t.toString()}function v(t){return null==t}function g(t){if("item"===t.type||"img"===t.type){var e="";return t.props.forEach(function(t){e+=" ".concat(t[0],'="').concat(t[1],'"')}),"text"===t.tagName?"<text".concat(e,">").concat(t.content,"</text>"):"<".concat(t.tagName).concat(e,"/>")}if("text"===t.type){var i="";return t.children.forEach(function(t){i+=g(t)}),"<g>".concat(i,"</g>")}if("dom"!==t.type&&"geom"!==t.type)return"<g></g>";var r="<g";return t.bbMask&&(r+=' mask="'.concat(t.bbMask,'"')),r+=">",t.bb.forEach(function(t){r+=g(t)}),r+="</g><g",t.props&&t.props.forEach(function(t){r+=" ".concat(t[0],'="').concat(t[1],'"')}),r+=">",t.children.forEach(function(t){t.isMask||(r+=g(t))}),r+="</g>",'<g opacity="'.concat(t.opacity,'" transform="').concat(y(t.transform),'"').concat(t.mask?' mask="'.concat(t.mask,'"'):"",'">').concat(r,"</g>")}function y(t){var e="";return t.forEach(function(t){e+="".concat(t[0],"(").concat(t[1],") ")}),e}function m(t){var e="<".concat(t.tagName,' id="').concat(t.uuid,'"');return"mask"===t.tagName?e+=' maskUnits="userSpaceOnUse"':e+=' gradientUnits="userSpaceOnUse"',t.props.forEach(function(t){e+=" ".concat(t[0],'="').concat(t[1],'"')}),e+=">",t.children.forEach(function(t){e+=function(t){var e="<".concat(t.tagName);return t.props.forEach(function(t){e+=" ".concat(t[0],'="').concat(t[1],'"')}),e+="></".concat(t.tagName,">")}(t)}),e+="</".concat(t.tagName,">")}var ie={isObject:e("Object"),isString:e("String"),isFunction:e("Function"),isNumber:d,isBoolean:e("Boolean"),isDate:e("Date"),stringify:p,joinSourceArray:function(t){return function t(e){for(var i="",r=0,n=e.length;r<n;r++){var a=e[r];Array.isArray(a)?i+=t(a):i+=p(a)}return i}(t)},encodeHtml:function(t,e){return e?t.replace(/"/g,"&quot;"):t.replace(/&/g,"&amp;").replace(/</g,"&lt;")},isNil:v,joinVirtualDom:function(t){var e="<defs>";return t.defs.forEach(function(t){e+=m(t)}),e+="</defs><g",t.bbMask&&(e+=' mask="'.concat(t.bbMask,'"')),e+=">",t.bb.forEach(function(t){e+=g(t)}),e+="</g><g>",t.children.forEach(function(t){t.isMask||(e+=g(t))}),e+="</g>"},joinVd:g,joinTransform:y,joinDef:m,d2r:function(t){return t*Math.PI/180},rgb2int:function(t){var e=[];if("#"===t.charAt(0))3===(t=t.slice(1)).length?(e.push(parseInt(t.charAt(0)+t.charAt(0),16)),e.push(parseInt(t.charAt(1)+t.charAt(1),16)),e.push(parseInt(t.charAt(2)+t.charAt(2),16))):6===t.length&&(e.push(parseInt(t.slice(0,2),16)),e.push(parseInt(t.slice(2,4),16)),e.push(parseInt(t.slice(4),16))),e[3]=1;else{if("transparent"===t)return[0,0,0,0];var i=t.match(/rgba?\s*\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)(?:\s*,\s*([\d.]+))?\s*\)/i);i&&(e=[parseInt(i[1]),parseInt(i[2]),parseInt(i[3])],i[4]?e[3]=parseFloat(i[4]):e[3]=1)}return e},arr2hash:function(t){for(var e={},i=0,r=t.length;i<r;i++){var n=t[i];if(Array.isArray(n))e[n[0]]=n[1];else for(var a=Object.keys(n),o=a.length-1;0<=o;o--){var s=a[o];e[s]=n[s]}}return e},hash2arr:function(t){if(Array.isArray(t))return t;for(var e=[],i=Object.keys(t),r=0,n=i.length;r<n;r++){var a=i[r];e.push([a,t[a]])}return e},clone:function t(e){if(v(e)||"object"!==a(e))return e;if(ie.isDate(e))return new Date(e);var i=Array.isArray(e)?[]:{};for(var r in e)e.hasOwnProperty(r)&&(i[r]=t(e[r]));return i},mergeImageData:function(t,e){for(var i=t.data,r=e.data,n=0,a=i.length;n<a;n+=4){var o=i[n],s=i[n+1],h=i[n+2],u=i[n+3],l=r[n],c=r[n+1],f=r[n+2],_=r[n+3];if(0===_);else if(0===u||255===_)i[n]=l,i[n+1]=c,i[n+2]=f,i[n+3]=_;else{var d=u/255,p=_/255,v=1-d,g=o*d+l*p*v,y=s*d+c*p*v,m=h*d+f*p*v,k=1-(1-d)*(1-p);0!=k&&1!=k&&(g/=k,y/=k,m/=k),i[n]=g,i[n+1]=y,i[n+2]=m,i[n+3]=k}}return t}};var C={identity:function(){for(var t=[],e=0;e<16;e++)t.push(e%5==0?1:0);return t},multiply:function(t,e){for(var i=[],r=0;r<4;r++)for(var n=[t[r],t[r+4],t[r+8],t[r+12]],a=0;a<4;a++){var o=4*a,s=[e[o],e[1+o],e[2+o],e[3+o]],h=n[0]*s[0]+n[1]*s[1]+n[2]*s[2]+n[3]*s[3];i[r+o]=h}return i},t43:function(t){return[t[0],t[1],t[4],t[5],t[12],t[13]]},calPoint:function(t,e){var i=Jt(t,2),r=i[0],n=i[1];return[e[0]*r+e[2]*n+e[4],e[1]*r+e[3]*n+e[5]]}};function k(t,e,i){var r=Jt(t,6),n=r[0],a=r[1],o=r[2],s=r[3];return[n*e+o*i+r[4],a*e+s*i+r[5]]}function b(t,e,i,r){return t*r-i*e}function x(t){var e=C.identity();return e[0]=t[0],e[1]=t[1],e[4]=t[2],e[5]=t[3],e[12]=t[4],e[13]=t[5],e}var re={calMatrix:function(t,e,i,r,n,a){var o=Jt(e,2),s=o[0],h=o[1],u=function(t,e,i,n,a){var o=[];return t.forEach(function(t){var e=Jt(t,2),i=e[0],r=e[1];"translateX"===i?r.unit===G.PERCENT?o.push([t[0],r.value*n*.01]):o.push([t[0],t[1].value]):"translateY"===i?r.unit===G.PERCENT?o.push([t[0],r.value*a*.01]):o.push([t[0],t[1].value]):"matrix"===i?o.push([t[0],t[1]]):o.push([t[0],t[1].value])}),o}(t,0,0,n,a),l=C.identity();l[12]=s,l[13]=h,u.forEach(function(t){var e=Jt(t,2),i=e[0],r=e[1],n=C.identity();if("translateX"===i)n[12]=r;else if("translateY"===i)n[13]=r;else if("scaleX"===i)n[0]=r;else if("scaleY"===i)n[5]=r;else if("skewX"===i)r=ie.d2r(r),n[4]=Math.tan(r);else if("skewY"===i)r=ie.d2r(r),n[1]=Math.tan(r);else if("rotateZ"===i){r=ie.d2r(r);var a=Math.sin(r),o=Math.cos(r);n[0]=n[5]=o,n[1]=a,n[4]=-a}else"matrix"===i&&(n[0]=r[0],n[1]=r[1],n[4]=r[2],n[5]=r[3],n[12]=r[4],n[13]=r[5]);l=C.multiply(l,n)});var c=C.identity();return c[12]=-s,c[13]=-h,l=C.multiply(l,c),C.t43(l)},calOrigin:function(t,i,r,n,a){var o=[];return t.forEach(function(t,e){t.unit===G.PX?o.push(t.value+e?r:i):t.unit===G.PERCENT&&o.push((e?r:i)+t.value*(e?a:n)*.01)}),o},pointInQuadrilateral:function(t,e,i,r,n,a,o,s,h,u,l){if(!l)return i<=t&&r<=e&&t<=h&&e<=u;var c=Jt(k(l,i,r),2);i=c[0],r=c[1];var f=Jt(k(l,n,a),2);n=f[0],a=f[1];var _=Jt(k(l,o,s),2);o=_[0],s=_[1];var d=Jt(k(l,h,u),2);return h=d[0],u=d[1],0<b(n-i,a-r,t-i,e-r)&&0<b(h-n,u-a,t-n,e-a)&&0<b(o-h,s-u,t-h,e-u)&&0<b(i-o,r-s,t-o,e-s)||void 0},mergeMatrix:function(t,e){var i=x(t),r=x(e),n=C.multiply(i,r);return[n[0],n[1],n[4],n[5],n[12],n[13]]}};function w(t,e){for(var i=[],r=0,n=t.length;r<n;r++){var a=t[r];if(1<a.length){var o=a[0],s=a[1];s.unit===G.PERCENT?i.push([o,.01*s.value]):i.push([o,s.value/e])}else i.push(a[0])}1<i.length?(Array.isArray(i[0])||(i[0]=[i[0],0]),Array.isArray(i[i.length-1])||(i[i.length-1]=[i[i.length-1],1])):Array.isArray(i[0])||(i[0]=[i[0],0]);for(var h=i[0][1],u=1,l=i.length;u<l-1;u++){var c=i[u];if(Array.isArray(c))h=c[1];else{for(var f=u+1,_=i[i.length-1][1];f<l-1;f++){var d=i[f];if(Array.isArray(d)){_=d[1];break}}for(var p=(_-h)/(f-u+1),v=u;v<f;v++){var g=i[v];i[v]=[g,h+p*(v+1-u)]}u=f}}for(var y=1,m=i.length;y<m;y++){var k=i[y],b=i[y-1];k[1]<b[1]&&(k[1]=b[1])}for(var x=0,w=i.length;x<w-1;x++){if(1<i[x][1]){i.splice(x+1);break}}for(var A=i.length-1;0<A;A--){if(i[A][1]<0){i.splice(0,A);break}}var E=i.length;if(1===E)i[0][1]=0;else{for(var T=!0,M=!0,P=E-1;0<=P;P--){var S=i[P][1];0<S&&(T=!1),S<1&&(M=!1)}if(T)i.splice(0,E-1),i[0][1]=0;else if(M)i.splice(1),i[0][1]=0;else{var O=i[0],R=i[E-1];if(2===E)O[1]<0&&1<R[1]&&function(t,e,i){var r=ie.rgb2int(t[0]),n=ie.rgb2int(e[0]),a=Jt(r,4),o=a[0],s=a[1],h=a[2],u=a[3],l=void 0===u?1:u,c=Jt(n,4),f=c[0],_=c[1],d=c[2],p=c[3],v=void 0===p?1:p,g=Math.abs(t[1])*i,y=e[1]*i,m=g/(g+y),k=Math.floor(o+(f-o)*m),b=Math.floor(s+(_-s)*m),x=Math.floor(h+(d-h)*m),w=l+(v-l)*m;t[0]="rgba(".concat(k,",").concat(b,",").concat(x,",").concat(w,")"),t[1]=0,m=(i+g)/(g+y),k=Math.floor(o+(f-o)*m),b=Math.floor(s+(_-s)*m),x=Math.floor(h+(d-h)*m),w=l+(v-l)*m,e[0]="rgba(".concat(k,",").concat(b,",").concat(x,",").concat(w,")"),e[1]=1}(O,R,e);else{if(O[1]<0){var N=i[1],C=ie.rgb2int(O[0]),L=ie.rgb2int(N[0]),W=function(t,e,i,r,n){var a=Jt(t,4),o=a[0],s=a[1],h=a[2],u=a[3],l=void 0===u?1:u,c=Jt(i,4),f=c[0],_=c[1],d=c[2],p=c[3],v=void 0===p?1:p,g=Math.abs(e)*n,y=g/(r*n+g),m=Math.floor(o+(f-o)*y),k=Math.floor(s+(_-s)*y),b=Math.floor(h+(d-h)*y);return[m,k,b,l+(v-l)*y]}(C,O[1],L,N[1],e);O[0]="rgba(".concat(W[0],",").concat(W[1],",").concat(W[2],",").concat(W[3],")"),O[1]=0}if(1<R[1]){var I=i[E-2],F=ie.rgb2int(I[0]),B=ie.rgb2int(R[0]),D=function(t,e,i,r,n){var a=Jt(t,4),o=a[0],s=a[1],h=a[2],u=a[3],l=void 0===u?1:u,c=Jt(i,4),f=c[0],_=c[1],d=c[2],p=c[3],v=void 0===p?1:p,g=e*n,y=(n-g)/(r*n-g),m=Math.floor(o+(f-o)*y),k=Math.floor(s+(_-s)*y),b=Math.floor(h+(d-h)*y);return[m,k,b,l+(v-l)*y]}(F,I[1],B,R[1],e);R[0]="rgba(".concat(D[0],",").concat(D[1],",").concat(D[2],",").concat(D[3],")"),R[1]=1}}}}return i.forEach(function(t){t[1]<0?t[1]=0:1<t[1]&&(t[1]=1)}),i}var A=/\b(\w+)-gradient\((.+)\)/;var E={reg:A,parseGradient:function(t){var e=A.exec(t);if(e){var i={k:e[1]},r=/(-?[\d.]+deg)|(to\s+[toprighbml]+)|circle|ellipse|at|closest|farthest|((closest|farthest)-(side|corner))/.exec(e[2]),n=e[2].match(/((#[0-9a-f]{3,6})|(rgba?\(.+?\)))(\s+-?[\d.]+(px|%))?/gi);if(i.v=n.map(function(t){var e=t.split(/\s+/);return e[1]&&(/%$/.test(e[1])?e[1]={value:parseFloat(e[1]),unit:G.PERCENT,str:e[1]}:e[1]={value:parseFloat(e[1]),unit:G.PX,str:e[1]}),e}),r){var a=e[2].indexOf(",");"linear"===i.k?i.d=function(t){var e=180;if("to top"===t)e=0;else if("to top right"===t)e=45;else if("to right"===t)e=90;else if("to bottom right"===t)e=135;else if("to bottom"===t);else if("to bottom left"===t)e=225;else if("to left"===t)e=270;else if("to top left"===t)e=315;else{var i=/(-?[\d.]+)deg/.exec(t);i&&(e=parseFloat(i[1]))}return e%360}(e[2].slice(0,a)):i.d=e[2].slice(0,a)}else"linear"===i.k?i.d=180:i.d="farthest-corner";return i}},getLinear:function(t,e,i,r,n,a){var o=ie.d2r(e),s=Math.abs(n*Math.sin(o))+Math.abs(a*Math.cos(o)),h=Jt(function(t,e,i,r){var n,a,o,s;if(270<=t){var h=ie.d2r(360-t);n=i+Math.sin(h)*e,a=r+Math.cos(h)*e,o=i-Math.sin(h)*e,s=r-Math.cos(h)*e}else if(180<=t){var u=ie.d2r(t-180);n=i+Math.sin(u)*e,a=r-Math.cos(u)*e,o=i-Math.sin(u)*e,s=r+Math.cos(u)*e}else if(90<=t){var l=ie.d2r(180-t);n=i-Math.sin(l)*e,a=r-Math.cos(l)*e,o=i+Math.sin(l)*e,s=r+Math.cos(l)*e}else{var c=ie.d2r(t);n=i-Math.sin(c)*e,a=r+Math.cos(c)*e,o=i+Math.sin(c)*e,s=r-Math.cos(c)*e}return[n,a,o,s]}(e,.5*s,i,r),4);return{x1:h[0],y1:h[1],x2:h[2],y2:h[3],stop:w(t,s)}},getRadial:function(t,e,i,r,n,a,o,s){var h=o-n,u=s-a,l=Jt(function(t,e,i,r,n,a,o,s,h){var u,l,c,f="farthest-corner";if(/circle|ellipse|at|closest|farthest/i.test(t)){var _,d,p=t.indexOf("at");if(-1<p&&(_=t.slice(p+2),d=t.slice(0,p-1)),(d=/(closest|farthest)-(side|corner)/.exec(d))?f=d[0]:(d=/\s+(-?[\d.]+(?:px|%))\s*(-?[\d.]+(?:px|%))?/.exec(d))&&(f=null,u=-1<d[1].indexOf("px")?.5*parseFloat(d[1]):parseFloat(d[1])*e*.005),_&&(d=/\s+(-?[\d.]+(?:px|%))\s*(-?[\d.]+(?:px|%))?/.exec(_))){r=-1<d[1].indexOf("px")?a+parseFloat(d[1]):a+parseFloat(d[1])*e*.01;var v=d[2]||d[1];n=-1<v.indexOf("px")?o+parseFloat(v):o+parseFloat(v)*i*.01}}if(f)if("closest-side"===f)u=r<=a||s<=r||n<=o||h<=n?0:(l=r<a+.5*e?r-a:s-r,c=n<o+.5*i?n-o:h-n,Math.min(l,c));else if("closest-corner"===f){var g,y;g=r<a+.5*e?r-a:s-r,y=n<o+.5*i?n-o:h-n,u=Math.sqrt(Math.pow(g,2)+Math.pow(y,2))}else if("farthest-side"===f)if(r<=a)u=a-r+e;else if(s<=r)u=r-s+e;else if(n<=o)u=o-n+i;else if(h<=r)u=n-h+i;else{var m=Math.max(s-r,r-a),k=Math.max(h-n,n-o);u=Math.max(m,k)}else{var b,x;b=r<a+.5*e?s-r:r-a,x=n<o+.5*i?h-n:n-o,u=Math.sqrt(Math.pow(b,2)+Math.pow(x,2))}return[u,r,n]}(e,h,u,i,r,n,a,o,s),3),c=l[0],f=l[1],_=l[2],d=w(t,2*c);if(c<=0){var p=d[d.length-1];p[1]=0,d=[p],f=n,_=a,c=h+u}return{cx:f,cy:_,r:c,stop:d}}};function T(t,e,i,r,n,a,o,s){var h=1,u=1,l=1;t:for(var c=a;n<=c;c--)for(var f=s;o<=f;f--){var _=c+f,d=Math.floor((t+f)/_),p=f;if(d*_<f+t)if(s<(p=(t-d*c)/(d-1)))continue;if(_=c+p,1<e&&c<e){if(c<e%_)continue;if(1<i)if(c<(e+r)%_)continue}if(1<i)if(c<(e+r)%_)continue;0<d&&(h=d,u=c,l=p);break t}return{n:h,ps:u,pd:l}}function M(t,e,i,r,n,a){var o=n-e,s=r-i,h=i-e,u=n-r;if("dotted"===t)return T(o,h,u,s,a,a,Math.max(1,.25*a),2*a);var l=T(o,h,u,s,a,3*a,Math.max(1,.25*a),2*a),c=l.n,f=l.ps,_=l.pd;return 1===c?T(o,h,u,s,a,a,Math.max(1,.25*a),2*a):{n:c,ps:f,pd:_}}var ne={calDashed:M,calPoints:function(t,e,i,r,n,a,o,s,h,u,l,c,f){var _=[];if(-1<["dashed","dotted"].indexOf(e)){var d=0===f||2===f?M(e,n,a,o,s,t):M(e,h,u,l,c,t),p=d.n,v=d.ps,g=d.pd;if(1<p){for(var y=0;y<p;y++){var m,k=y===p-1,b=void 0,x=void 0,w=void 0;m=(b=0===f||2===f?y?n+v*y+g*y:n:y?h+v*y+g*y:h)+v,0===f?m<a?k?_.push([n,h,s,h,o,u,a,u]):(x=h+(b-n)*Math.tan(i),w=h+(m-n)*Math.tan(i),_.push([b,h,m,h,m,w,b,x])):o<b?(x=h+(s-b)*Math.tan(r),w=h+(s-m)*Math.tan(r),k?_.push([b,h,s,h,b,x]):_.push([b,h,m,h,m,w,b,x])):b<a?(x=h+(b-n)*Math.tan(i),k?_.push([b,h,s,h,o,u,a,u,b,x]):o<m?_.push([b,h,m,h,o,u,a,u,b,x]):_.push([b,h,m,h,m,u,a,u,b,x])):o<m?(x=h+(s-m)*Math.tan(r),b<a?k?_.push([b,h,s,h,o,u,a,u,b,x]):_.push([b,h,m,h,m,x,o,u,a,u,b,x]):k?_.push([b,h,s,h,o,u,b,u]):_.push([b,h,m,h,m,x,o,u,b,u])):k?_.push([b,h,s,h,o,u,b,u]):_.push([b,h,m,h,m,u,b,u]):1===f?m<u?k?_.push([o,u,s,h,s,c,o,l]):(x=s-(m-h)*Math.tan(i),w=s-(b-h)*Math.tan(i),_.push([x,m,w,b,s,b,s,m])):l<b?(x=o+(b-l)*Math.tan(r),w=o+(m-l)*Math.tan(r),k?_.push([x,b,s,b,s,c]):_.push([x,b,s,b,s,m,w,m])):b<u?(x=o+(u-b)*Math.tan(i),k?_.push([o,u,x,b,s,b,s,c,o,c]):l<m?_.push([o,u,x,b,s,b,s,m,x,m,o,l]):_.push([o,u,x,b,s,b,s,m,o,m])):l<m?(x=o+(m-l)*Math.tan(r),b<u?k?_.push([o,u,x,b,s,b,s,c,o,l]):_.push([o,u,x,b,s,b,s,m,x,m,o,l]):k?_.push([o,b,s,b,s,c,o,l]):_.push([o,b,s,b,s,m,x,m,o,l])):k?_.push([o,b,s,b,s,c,o,l]):_.push([o,b,s,b,s,m,o,m]):2===f?m<a?k?_.push([n,c,a,l,o,l,s,c]):(x=c-(b-n)*Math.tan(i),w=c-(m-n)*Math.tan(i),_.push([b,x,m,w,m,c,b,c])):o<b?(x=c-(b-n)*Math.tan(r),w=c-(m-n)*Math.tan(r),k?_.push([b,x,s,c,b,c]):_.push([b,x,m,w,m,c,b,c])):b<a?(x=l+(b-n)*Math.tan(i),k?_.push([b,x,a,l,o,l,s,c,b,c]):o<m?_.push([b,x,a,l,o,l,m,c,b,c]):_.push([b,x,a,l,m,l,m,c,b,c])):o<m?(x=c-(s-m)*Math.tan(r),b<a?k?_.push([b,x,o,l,s,c,b,c]):_.push([b,x,o,l,m,x,m,c,b,c]):k?_.push([b,l,o,l,s,c,b,c]):_.push([b,l,o,l,m,x,m,c,b,c])):k?_.push([b,l,o,l,s,c,b,c]):_.push([b,l,m,l,m,c,b,c]):3===f&&(m<u?k?_.push([n,h,a,u,a,l,n,c]):(x=n+(b-h)*Math.tan(i),w=n+(m-h)*Math.tan(i),_.push([n,b,x,b,w,m,n,m])):l<b?(x=n+(c-b)*Math.tan(r),w=n+(c-m)*Math.tan(r),k?_.push([n,b,x,b,n,c]):_.push([n,b,x,b,w,m,n,m])):b<u?(x=n+(b-h)*Math.tan(i),k?_.push([n,b,x,b,a,u,a,l,n,c]):l<m?_.push([n,b,x,b,a,u,a,l,x,m,n,m]):_.push([n,b,x,b,a,u,a,m,n,m])):l<m?(x=n+(c-m)*Math.tan(r),b<u?k?_.push([n,b,x,b,a,u,a,l,n,c]):_.push([n,b,x,b,a,u,a,l,x,m,n,m]):k?_.push([n,b,a,b,a,l,n,c]):_.push([n,b,a,b,a,l,x,m,n,m])):k?_.push([n,b,a,b,a,l,n,c]):_.push([n,b,a,b,a,m,n,m]))}return _}}return 0===f?_.push([n,h,s,h,o,u,a,u]):1===f?_.push([o,u,s,h,s,c,o,l]):2===f?_.push([n,c,a,l,o,l,s,c]):3===f&&_.push([n,h,a,u,a,l,n,c]),_}};function P(t,e,i){var r=t[e];t[e]=t[i],t[i]=r}function S(t,e){return!Array.isArray(t)||t.length<2||(e=e||function(){},function t(e,i,r,n){if(!(r<=i)){for(var a=i,o=r,s=a,h=e[s],u=!0;a<o;)if(u){for(;a<o;o--)if(n.call(e,h,e[o])){P(e,s,o),s=o,u=!u,a++;break}}else for(;a<o;a++)if(n.call(e,e[a],h)){P(e,s,a),s=a,u=!u,o--;break}t(e,i,s-1,n),t(e,s+1,r,n)}}(t,0,t.length-1,e)),t}var O={arial:{lhr:1.14990234375,car:1.1171875,blr:.9052734375,mdr:.64599609375,lgr:.03271484375}};var ae={matrixResize:function(t,e,i,r,n,a,o,s){if(t!==i||e!==r){var h=[["scaleX",{value:i/t,unit:G.NUMBER}],["scaleY",{value:r/e,unit:G.NUMBER}]],u=re.calOrigin([{value:0,unit:G.PERCENT},{value:0,unit:G.PERCENT}],n,a,o,s);return re.calMatrix(h,u,n,a,o,s)}},reg:/url\((['"]?)(.*?)\1\)/};function R(t,e){var i="border".concat(e);if(t[i]){var r=/\b[\d.]+px\b/i.exec(t[i]);r&&(t[i+"Width"]=r[0]);var n=/\b(solid|dashed|dotted)\b/i.exec(t[i]);n&&(t[i+"Style"]=n[1]);var a=/#[0-9a-f]{3,6}/i.exec(t[i]);a&&-1<[4,7].indexOf(a[0].length)?t[i+"Color"]=a[0]:/\btransparent\b/i.test(t[i])?t[i+"Color"]="transparent":(a=/rgba?\(.+\)/i.exec(t[i]))&&(t[i+"Color"]=a[0])}}function N(t,e,i){return"auto"===i?t[e]={unit:G.AUTO}:"inherit"===i?t[e]={unit:G.INHERIT}:/%$/.test(i)?0===e.toString().indexOf("border")?t[e]={value:0,unit:G.PX}:(i=parseFloat(i)||0,t[e]={value:i,unit:G.PERCENT}):(i=parseFloat(i)||0,t[e]={value:i,unit:G.PX}),t}function L(e,i,t,r){var n=e.fontStyle,a=e.fontWeight,o=e.fontSize,s=e.fontFamily,h=e.color;i.fontStyle="inherit"===n?r?"normal":t.fontStyle:n,i.fontWeight="inherit"===a?r?400:t.fontWeight:a,function(t,e,i,r){e.unit===G.INHERIT?t.fontSize=r?16:i.fontSize:e.unit===G.PX?t.fontSize=e.value:e.unit===G.PERCENT?t.fontSize=r?16*e.value:i.fontSize*e.value:t.fontSize=16}(i,o,t,r),i.fontFamily="inherit"===s?r?"arial":t.fontFamily:s,i.color="inherit"===h?r?"#000":t.color:h,["borderTopWidth","borderRightWidth","borderBottomWidth","borderLeftWidth"].forEach(function(t){i[t]=e[t].value||0}),["visibility","backgroundColor","borderBottomColor","borderLeftColor","borderRightColor","borderTopColor","opacity"].forEach(function(t){i[t]=e[t]})}function W(t,e,i){if(ie.isNumber(e),e.unit===G.INHERIT){var r=t.parent;if(r){var n=r.style.lineHeight;if(n.unit===G.INHERIT)for(r=r.parent;r&&(n=r.style.lineHeight).unit===G.INHERIT;);var a=r.computedStyle;n.unit===G.PX?i.lineHeight=a.lineHeight:n.unit===G.NUMBER?i.lineHeight=Math.max(n.value,0)*i.fontSize:i.lineHeight=I(i)}else e.unit=G.AUTO,i.lineHeight=W(i)}else e.unit===G.PX?i.lineHeight=Math.max(e.value,0)||I(i):e.unit===G.NUMBER?i.lineHeight=Math.max(e.value,0)*i.fontSize||I(i):i.lineHeight=I(i)}function I(t){return t.fontSize*O.arial.lhr}function F(t,e,i){for(t*=.01;e;){var r=e.style[i];if(r.unit===G.AUTO){if("width"!==i)break;e=e.parent}else{if(r.unit===G.PX)return t*r.value;r.unit===G.PERCENT&&(t*=.01*r.value,e=e.parent)}}return t}var B={normalize:function(i,t){t&&t.forEach(function(t){i.hasOwnProperty(t.k)||(i[t.k]=t.v)});var e=i.background;if(e){var r=E.reg.exec(e);r&&(i.backgroundImage=r[0],e=e.replace(r[0],""));var n=ae.reg.exec(e);n&&(i.backgroundImage=n[0],e=e.replace(n[0],""));var a=/(no-)?repeat(-[xy])?/i.exec(e);a&&(i.backgroundRepeat=a[0].toLowerCase());var o=/\s+(((-?[\d.]+(px|%)?)|(left|top|right|bottom|center))\s*){1,2}/gi.exec(e);o&&(i.backgroundPosition=o[0].trim());var s=/^\s*(#[0-9a-f]{3,6})|(rgba?\(.+?\))/i.exec(e);s&&(i.backgroundColor=s[0])}if((e=i.backgroundImage)&&(E.reg.test(e)?i.backgroundImage=E.parseGradient(e):ae.reg.test(e)&&(i.backgroundImage=ae.reg.exec(e)[2])),e=i.backgroundColor){i.backgroundColor="transparent";var h=/^#[0-9a-f]{3,6}/i.exec(e);h&&-1<[4,7].indexOf(h[0].length)?i.backgroundColor=h[0]:(h=/rgba?\(.+\)/i.exec(e))&&(i.backgroundColor=h[0])}if(e=i.backgroundPosition){1===(e=e.split(/\s+/)).length&&(e[1]="50%");var u=Jt(e,2);i.backgroundPositionX=u[0],i.backgroundPositionY=u[1]}if((e=i.backgroundPositionX)&&(/%$/.test(e)?i.backgroundPositionX={value:parseFloat(e)||0,unit:G.PERCENT}:/^[\d.]/.test(e)?i.backgroundPositionX={value:parseFloat(e),unit:G.PX}:i.backgroundPositionX={value:e,unit:G.POSITION}),(e=i.backgroundPositionY)&&(/%$/.test(e)?i.backgroundPositionY={value:parseFloat(e)||0,unit:G.PERCENT}:/^[\d.]/.test(e)?i.backgroundPositionY={value:parseFloat(e),unit:G.PX}:i.backgroundPositionY={value:e,unit:G.POSITION}),e=i.backgroundSize){var l=e.toString().match(/(-?[\d.]+(px|%)?)|(contain|cover|auto)/gi);if(l){1===l.length&&(l[1]=l[0]);for(var c=[],f=0;f<2;f++){var _=l[f];/%$/.test(_)?c.push({value:parseFloat(_)||0,unit:G.PERCENT}):/^[\d.]/.test(_)?c.push({value:parseFloat(_),unit:G.PX}):"contain"===_||"cover"===_?c.push({value:_,unit:G.SIZE}):c.push({unit:G.AUTO})}i.backgroundSize=c}else i.backgroundSize=[{unit:G.AUTO},{unit:G.AUTO}]}if((e=i.flex)&&("none"===e?(i.flexGrow=0,i.flexShrink=0,i.flexBasis="auto"):"auto"===e?(i.flexGrow=1,i.flexShrink=1,i.flexBasis="auto"):/^[\d.]+$/.test(e)?(i.flexGrow=parseFloat(e),i.flexShrink=1,i.flexBasis=0):/^[\d.]+px$/.test(e)||/^[\d.]+%$/.test(e)||(i.flexGrow=0,i.flexShrink=1,i.flexBasis="auto")),(e=i.border)&&(i.borderTop=i.borderRight=i.borderBottom=i.borderLeft=e),e=i.margin){var d=e.toString().match(/(-?[\d.]+(px|%)?)|(auto)/gi);d&&(1===d.length?d[3]=d[2]=d[1]=d[0]:2===d.length?(d[2]=d[0],d[3]=d[1]):3===d.length&&(d[3]=d[1]),i.marginTop=d[0],i.marginRight=d[1],i.marginBottom=d[2],i.marginLeft=d[3])}if(e=i.padding){var p=e.toString().match(/(-?[\d.]+(px|%)?)|(auto)/gi);p&&(1===p.length?p[3]=p[2]=p[1]=p[0]:2===p.length?(p[2]=p[0],p[3]=p[1]):3===p.length&&(p[3]=p[1]),i.paddingTop=p[0],i.paddingRight=p[1],i.paddingBottom=p[2],i.paddingLeft=p[3])}if(e=i.transform){var v=e.toString().match(/\w+\(.+?\)/g);if(v){var g=i.transform=[];v.forEach(function(t){var e=t.indexOf("("),i=t.slice(0,e),r=t.slice(e+1,t.length-1);if("matrix"===i){var n=r.split(/\s*,\s*/);6<(n=n.map(function(t){return parseFloat(t)})).length&&(n=n.slice(0,6)),6===n.length&&g.push(["matrix",n])}else if("translateX"===i){var a=["translateX",r];g.push(N(a,1,r))}else if("translateY"===i){var o=["translateY",r];g.push(N(o,1,r))}else if("translate"===i){var s=r.split(/\s*,\s*/),h=["translateX",s[0]],u=["translateY",s[1]||s[0]];g.push(N(h,1,s[0])),g.push(N(u,1,s[1]||s[0]))}else if("scaleX"===i)g.push(["scaleX",{value:parseFloat(r)||0,unit:G.NUMBER}]);else if("scaleY"===i)g.push(["scaleY",{value:parseFloat(r)||0,unit:G.NUMBER}]);else if("scale"===i){var l=r.split(/\s*,\s*/),c=parseFloat(l[0])||0,f=parseFloat(l[l.length-1])||0;g.push(["scaleX",{value:c,unit:G.NUMBER}]),g.push(["scaleY",{value:f,unit:G.NUMBER}])}else if("rotateZ"===i||"rotate"===i)g.push(["rotateZ",{value:parseFloat(r)||0,unit:G.DEG}]);else if("skewX"===i)g.push(["skewX",{value:parseFloat(r)||0,unit:G.DEG}]);else if("skewY"===i)g.push(["skewY",{value:parseFloat(r)||0,unit:G.DEG}]);else if("skew"===i){var _=r.split(/\s*,\s*/),d=parseFloat(_[0])||0,p=parseFloat(_[_.length-1])||0;g.push(["skewX",{value:d,unit:G.DEG}]),g.push(["skewY",{value:p,unit:G.DEG}])}})}}if(e=i.transformOrigin){var y=e.toString().match(/(-?[\d.]+(px|%)?)|(left|top|right|bottom|center)/gi);if(y){1===y.length&&(y[1]=y[0]);for(var m=[],k=0;k<2;k++){var b=y[k];/%$/.test(b)?m.push({value:parseFloat(b)||0,unit:G.PERCENT}):/^[\d.]/.test(b)?m.push({value:parseFloat(b),unit:G.PX}):(m.push({value:{top:0,left:0,center:50,right:100,bottom:100}[b],unit:G.PERCENT}),void 0===m[k].value&&(m[k].value=50))}i.transformOrigin=m}else i.transformOrigin=[{value:50,unit:G.PERCENT},{value:50,unit:G.PERCENT}]}if((e=i.opacity)&&(e=parseFloat(e),isNaN(e)||(e=Math.max(e,0),e=Math.min(e,1),i.opacity=e)),R(i,"Top"),R(i,"Right"),R(i,"Bottom"),R(i,"Left"),["marginTop","marginRight","marginBottom","marginLeft","paddingTop","paddingRight","paddingBottom","paddingLeft","borderTopWidth","borderRightWidth","borderBottomWidth","borderLeftWidth","top","right","bottom","left","width","height","flexBasis","fontSize","strokeWidth"].forEach(function(t){var e=i[t];i.hasOwnProperty(t)&&N(i,t,e)}),!(e=i.fontWeight)&&0!==e||("bold"===e?i.fontWeight=700:"normal"===e?i.fontWeight=400:"lighter"===e?i.fontWeight=200:"inherit"!==e&&(i.fontWeight=parseInt(e)||400)),(e=i.lineHeight)||0===e)if("inherit"===e&&(i.lineHeight={unit:G.INHERIT}),"normal"===e)i.lineHeight={unit:G.AUTO};else if(/px$/.test(e))i.lineHeight={value:parseFloat(e),unit:G.PX};else{var x=parseFloat(e)||"normal";i.lineHeight="normal"===x?{unit:G.AUTO}:{value:x,unit:G.NUMBER}}if(e=i.strokeDasharray){var w=e.toString().match(/[\d.]+/g);i.strokeDasharray=w?w.join(", "):""}return(e=i.fill)&&0<e.indexOf("-gradient(")&&(i.fill=E.parseGradient(e)),(e=i.stroke)&&0<e.indexOf("-gradient(")&&(i.stroke=E.parseGradient(e)),delete i.background,delete i.flex,delete i.border,delete i.margin,delete i.padding,i},compute:function(t,e){var i=t.currentStyle,r=i.lineHeight,n=i.textAlign,a=t.__computedStyle=ie.clone(i),o=t.parent,s=o&&o.computedStyle;L(i,a,s,e),W(t,r,a),"inherit"===n&&(a.textAlign=e?"left":s.textAlign)},repaint:function(t,e){var i=t.currentStyle,r=t.computedStyle,n=t.parent;L(i,r,n&&n.computedStyle,e)},setFontStyle:function(t){var e=t.fontStyle,i=t.fontWeight,r=t.fontSize,n=t.fontFamily;return"".concat(e," ").concat(i," ").concat(r,"px/").concat(r,"px ").concat(n)},getBaseLine:function(t){var e=t.fontSize*O.arial.lhr;return.5*(t.lineHeight-e)+t.fontSize*O.arial.blr},calLineHeight:W,calRelative:function(t,e,i,r,n){return ie.isNumber(i)||(i.unit===G.AUTO?i=0:i.unit===G.PX?i=i.value:i.unit===G.PERCENT&&(i=F(i.value,r,n?"width":"height"))),t[e]=i},calAbsolute:function(t,e,i,r){return ie.isNumber(i)||(i.unit===G.AUTO?i=0:i.unit===G.PX?i=i.value:i.unit===G.PERCENT&&(i=i.value*r*.01)),t[e]=i}},D=function(){function a(t,e,i,r,n){f(this,a),this.__parent=t,this.__x=e,this.__y=i,this.__width=r,this.__content=n,this.__virtualDom={}}return s(a,[{key:"render",value:function(t,e){var i=this.content,r=this.x,n=this.y,a=this.parent,o=a.ox,s=a.oy,h=a.computedStyle;n+=B.getBaseLine(h),r+=o,n+=s,t===ee.CANVAS?e.fillText(i,r,n):t===ee.SVG&&(this.__virtualDom={type:"item",tagName:"text",props:[["x",r],["y",n],["fill",h.color],["font-family",h.fontFamily],["font-weight",h.fontWeight],["font-style",h.fontStyle],["font-size","".concat(h.fontSize,"px")]],content:ie.encodeHtml(i)})}},{key:"__offsetX",value:function(t){this.__x+=t}},{key:"__offsetY",value:function(t){this.__y+=t}},{key:"x",get:function(){return this.__x}},{key:"y",get:function(){return this.__y}},{key:"width",get:function(){return this.__width}},{key:"content",get:function(){return this.__content}},{key:"baseLine",get:function(){return B.getBaseLine(this.parent.computedStyle)}},{key:"virtualDom",get:function(){return this.__virtualDom}},{key:"parent",get:function(){return this.__parent}}]),a}(),U=function(){function d(t){var e;return f(this,d),(e=_(this,X(d).call(this))).__content=t.toString(),e.__lineBoxes=[],e.__charWidthList=[],e.__charWidth=0,e.__textWidth=0,e}return t(d,l),s(d,[{key:"__measure",value:function(){var t=this.ctx,e=this.content,i=this.computedStyle,r=this.charWidthList,n=this.renderMode;n===ee.CANVAS&&(t.font=B.setFontStyle(i));for(var a=i.fontSize+","+i.fontFamily,o=d.MEASURE_TEXT.data[a]=d.MEASURE_TEXT.data[a]||{key:a,style:i,hash:{},s:[]},s=d.CHAR_WIDTH_CACHE[a]=d.CHAR_WIDTH_CACHE[a]||{},h=0,u=!1,l=0,c=e.length;l<c;l++){var f=e.charAt(l),_=void 0;s.hasOwnProperty(f)?(_=s[f],r.push(_),h+=_,this.__charWidth=Math.max(this.charWidth,_)):n===ee.CANVAS?(_=s[f]=t.measureText(f).width,r.push(_),h+=_,this.__charWidth=Math.max(this.charWidth,_)):(o.hash.hasOwnProperty(f)||(o.s+=f),o.hash[f]=!0,r.push(-1),u=!0)}this.__textWidth=h,u&&d.MEASURE_TEXT.list.push(this)}},{key:"__measureCb",value:function(){for(var t=this.content,e=this.computedStyle,i=this.charWidthList,r=e.fontSize+","+e.fontFamily,n=d.CHAR_WIDTH_CACHE[r],a=0,o=0,s=i.length;o<s;o++)if(i[o]<0){var h=i[o]=n[t.charAt(o)];a+=h,this.__charWidth=Math.max(this.charWidth,h)}this.__textWidth+=a}},{key:"__layout",value:function(t,e){var i=this,r=t.x,n=t.y,a=t.w;t.h;this.__x=r,this.__y=n;var o=r,s=this.isDestroyed,h=this.content,u=this.currentStyle,l=this.computedStyle,c=this.lineBoxes,f=this.charWidthList;if(!s&&"none"!==u.display){this.__ox=this.__oy=0,c.splice(0);for(var _=0,d=0,p=0,v=h.length;d<v;)if((p+=f[d])===a){var g=new D(this,r,n,p,h.slice(_,d+1));c.push(g),o=Math.max(o,r+p),n+=l.lineHeight,d=_=d+1,p=0}else if(a<p){d===_&&(d=_+1);var y=new D(this,r,n,p-f[d],h.slice(_,d));c.push(y),o=Math.max(o,r+p-f[d]),n+=l.lineHeight,_=d,p=0}else d++;if(_<v&&_<d){for(p=0,d=_;d<v;d++)p+=f[d];var m=new D(this,r,n,p,h.slice(_,v));c.push(m),o=Math.max(o,r+p),n+=l.lineHeight}if(this.__width=o-r,this.__height=n-t.y,e)this.__lineBoxes=[];else{var k=u.textAlign;-1<["center","right"].indexOf(k)&&c.forEach(function(t){var e=i.__width-t.width;0<e&&t.__offsetX("center"===k?.5*e:e)})}}}},{key:"__offsetX",value:function(e,t){H(X(d.prototype),"__offsetX",this).call(this,e,t),t&&this.lineBoxes.forEach(function(t){t.__offsetX(e)})}},{key:"__offsetY",value:function(e,t){H(X(d.prototype),"__offsetY",this).call(this,e,t),t&&this.lineBoxes.forEach(function(t){t.__offsetY(e)})}},{key:"render",value:function(e){var t=this.isDestroyed,i=this.ctx,r=this.computedStyle;t||"none"===r.display||(e===ee.CANVAS&&(i.font=B.setFontStyle(r),i.fillStyle=r.color),this.lineBoxes.forEach(function(t){t.render(e,i)}),e===ee.SVG&&(this.__virtualDom={type:"text",children:this.lineBoxes.map(function(t){return t.virtualDom})}))}},{key:"__renderByMask",value:function(t){this.render(t)}},{key:"__tryLayInline",value:function(t){return t-this.textWidth}},{key:"__calMaxAndMinWidth",value:function(){var e=0;return this.charWidthList.forEach(function(t){e=Math.max(e,t)}),{max:this.textWidth,min:e}}},{key:"content",get:function(){return this.__content},set:function(t){this.__content=t}},{key:"lineBoxes",get:function(){return this.__lineBoxes}},{key:"charWidthList",get:function(){return this.__charWidthList}},{key:"charWidth",get:function(){return this.__charWidth}},{key:"textWidth",get:function(){return this.__textWidth}},{key:"baseLine",get:function(){var t=this.lineBoxes[this.lineBoxes.length-1];return t.y-this.y+t.baseLine}},{key:"currentStyle",get:function(){return this.style}},{key:"renderMode",get:function(){return this.__renderMode}}]),d}();function j(t,e){var i=t.class,r=t.tagName,n=t.id;S(i=i.slice(),function(t,e){return e<t});var a=[];i.length&&!function t(e,i,r,n){if(1<r-n){t(e,i,r,n+1);for(var a=0,o=i.length;a<o;a++)i.push(i[a]+"."+e[n])}i.push("."+e[n])}(i,a,i.length,0);var o=e.hasOwnProperty("_*."),s=e.hasOwnProperty("_*#"),h=e.hasOwnProperty("_*.#"),u=[r];return e.hasOwnProperty("_*")&&u.push("*"),n&&(n="#"+n,u.push(n),u.push(r+n),s&&u.push("*"+n)),a.forEach(function(t){u.push(t),u.push(r+t),o&&u.push("*"+t),n&&(u.push(t+n),u.push(r+t+n),h&&u.push("*"+t+n))}),u}function z(e,i){i._v.forEach(function(t){t[2]=i._p,e.push(t)})}function V(t){var e={};return t.forEach(function(t){e[t]=!0}),e}n(U,"CHAR_WIDTH_CACHE",{}),n(U,"MEASURE_TEXT",{list:[],data:{}});var Y={parse:function(t,e,i){if(i){var r=[];!function h(u,l,c,f){var _=this;var t=j(u,c);t.forEach(function(t){if(c.hasOwnProperty(t)){for(var i=c[t],e=u.parent;e;)h(e,l,i,f),e=e.parent;if(i.hasOwnProperty("_v")&&z(f,i),i.hasOwnProperty("_>")){var r=i["_>"];h(u.parent,_,r,f)}if(i.hasOwnProperty("_+")){var n=i["_+"],a=u.prev;if(a&&!(a instanceof U)){var o=j(a,n),s=V(o);Object.keys(n).forEach(function(t){var e=n[t];e.hasOwnProperty("_v")&&s.hasOwnProperty(t)&&z(f,e)})}}i.hasOwnProperty("_~")&&function(){for(var r=i["_~"],e=u.prev,t=function(){if(e instanceof U)return e=e.prev,"continue";var t=j(e,r),i=V(t);Object.keys(r).forEach(function(t){var e=r[t];e.hasOwnProperty("_v")&&i.hasOwnProperty(t)&&z(f,e)}),e=e.prev};e;)t()}()}})}(t,e,i,r),S(r,function(t,e){for(var i=t[2],r=e[2],n=0;n<3;n++)if(i[n]!==r[n])return i[n]>r[n];return t[0]>e[0]});for(var n={},a=r.length-1;0<=a;a--){var o=Jt(r[a][1],2),s=o[0],h=o[1];n.hasOwnProperty(s)||(n[s]=h)}return n}},splitClass:function(t){if(t=(t||"").trim())return t.split(/\s+/)},mergeCss:function t(e,i){if(!i)return e;if(!e)return i;for(var r in i)if(i.hasOwnProperty(r)){var n=i[r];!{_v:!0,_p:!0}.hasOwnProperty(r)&&"object"===a(n)&&e.hasOwnProperty(r)?e[r]=t(e[r],n):e[r]=n}return e}},$=function(){function o(){f(this,o),this.__eHash={}}return s(o,[{key:"on",value:function(t,e){var i=this;if(Array.isArray(t))for(var r=0,n=t.length;r<n;r++)i.on(t[r],e);else if(e){i.__eHash.hasOwnProperty(t)||(i.__eHash[t]=[]);for(var a=0,o=i.__eHash[t],s=o.length;a<s;a++)if(o[a]===e)return i;i.__eHash[t].push(e)}return i}},{key:"once",value:function(n,a){if(ie.isFunction(a)){var o=this;if(Array.isArray(n))for(var t=0,e=n.length;t<e;t++)o.once(n[t],a);else a&&o.on(n,function t(){for(var e=arguments.length,i=new Array(e),r=0;r<e;r++)i[r]=arguments[r];a.apply(o,i),o.off(n,t)});return this}}},{key:"off",value:function(t,e){if(Array.isArray(t))for(var i=0,r=t.length;i<r;i++)this.off(t[i],e);else if(this.__eHash.hasOwnProperty(t))if(e){for(var n=0,a=this.__eHash[t],o=a.length;n<o;n++)if(a[n]===e){a.splice(n,1);break}}else delete this.__eHash[t];return this}},{key:"emit",value:function(t){for(var e=arguments.length,i=new Array(1<e?e-1:0),r=1;r<e;r++)i[r-1]=arguments[r];if(Array.isArray(t))for(var n=0,a=t.length;n<a;n++)this.emit(t[n],i);else if(this.__eHash.hasOwnProperty(t)){var o=this.__eHash[t];if(o.length)for(var s=0,h=(o=o.slice()).length;s<h;s++){var u=o[s];ie.isFunction(u)&&u.apply(this,i)}}return this}}],[{key:"mix",value:function(){for(var t=arguments.length-1;0<=t;t--){var e=t<0||arguments.length<=t?void 0:arguments[t],i=new o;e.__eHash={};for(var r=["on","once","off","emit"],n=r.length-1;0<=n;n--){var a=r[n];e[a]=i[a]}}}}]),o}();n($,"KARAS_REFRESH","karas-refresh"),n($,"KARAS_BEFORE_REFRESH","karas-before-refresh"),n($,"KARAS_ANIMATION_PAUSE","karas-animation-pause"),n($,"KARAS_ANIMATION_FRAME","karas-animation-frame"),n($,"KARAS_ANIMATION_FINISH","karas-animation-finish"),n($,"KARAS_ANIMATION_CANCEL","karas-animation-cancel");var q={position:"static",display:"block",top:"auto",right:"auto",bottom:"auto",left:"auto",marginTop:0,marginRight:0,marginBottom:0,marginLeft:0,paddingTop:0,paddingRight:0,paddingBottom:0,paddingLeft:0,fontSize:"inherit",fontFamily:"arial",color:"inherit",fontStyle:"inherit",fontWeight:"inherit",lineHeight:"normal",backgroundColor:"transparent",backgroundSize:"auto",backgroundRepeat:"repeat",backgroundPositionX:"0%",backgroundPositionY:"0%",borderTopWidth:0,borderRightWidth:0,borderBottomWidth:0,borderLeftWidth:0,borderTopColor:"#000",borderRightColor:"#000",borderBottomColor:"#000",borderLeftColor:"#000",borderTopStyle:"solid",borderRightStyle:"solid",borderBottomStyle:"solid",borderLeftStyle:"solid",width:"auto",height:"auto",flexGrow:0,flexShrink:1,flexBasis:"auto",flexDirection:"row",justifyContent:"flex-start",alignItems:"stretch",textAlign:"inherit",transformOrigin:"center",visibility:"visible",opacity:1},K={fill:"transparent",stroke:"#000",strokeWidth:1,strokeDasharray:"",strokeLinecap:"butt"},Z=[];for(var Q in q)if(q.hasOwnProperty(Q)){var J=q[Q];Z.push({k:Q,v:J})}var tt=ie.clone(Z);for(var et in K)if(K.hasOwnProperty(et)){var it=K[et];tt.push({k:et,v:it})}var rt={dom:Z,geom:tt},nt={REPAINT:0,REFLOW:1},at=function(){function a(t,e,i){var r;return f(this,a),r=_(this,X(a).call(this)),ie.isString(t)||(i=e,e=t,t=/(?:function|class)\s+([\w$]+)/.exec(r.constructor.toString())[1]),r.__tagName=t,e=e||[],Array.isArray(e)?(r.props=ie.arr2hash(e),r.__props=e):(r.props=e,r.__props=ie.hash2arr(e)),r.__children=i||[],r.__shadowRoot=null,r.__parent=null,r.__ref={},r.__state={},r}return t(a,$),s(a,[{key:"setState",value:function(t,e){if(ie.isNil(t))this.state={};else for(var i in t)t.hasOwnProperty(i)&&(this.state[i]=t[i]);var r=this.shadowRoot;if(r){var n=this.root;n&&(n.setRefreshLevel(nt.REFLOW),this.__traverse(r.ctx,r.defs,this.root.renderMode),this.__init(),n.addRefreshTask(e))}}},{key:"__traverse",value:function(t,e,i){for(var r=this.__shadowRoot=this.render(i);r instanceof a;)r=this.__shadowRoot=r.render(i);if(!(r instanceof l)){var n="";return ie.isNil(r)||(n=ie.encodeHtml(r.toString())),(r=new U(n)).__ctx=t,r.__defs=e,r.__renderMode=i,r.__style=this.props.style||{},void(this.__shadowRoot=r)}r.__ctx=t,r.__defs=e,r.__host=this,r.isGeom()||r.__traverse(t,e,i)}},{key:"__traverseCss",value:function(){var t=this.__shadowRoot;if(!(t instanceof U)){var e=Y.mergeCss(t.props.css,this.props.css);t.__traverseCss(t,e)}}},{key:"__init",value:function(){var r=this,n=this.shadowRoot;if(n instanceof U)B.normalize(n.style,rt.dom);else{var t=this.props.style||{};for(var e in t)t.hasOwnProperty(e)&&(n.style[e]=t[e]);n.__init()}n instanceof U||this.__props.forEach(function(t){var e=t[0],i=t[1];/^on[a-zA-Z]/.test(e)?(e=e.slice(2).toLowerCase(),(n.listener[e]=n.listener[e]||[]).push(i)):/^on-[a-zA-Z\d_$]/.test(e)&&(e=e.slice(3),r.on(e,function(){i.apply(void 0,arguments)}))}),this.__hasInit||(this.__hasInit=!0,["x","y","ox","oy","sx","sy","width","height","outerWidth","outerHeight","style","computedStyle","ctx","defs","baseLine","virtualDom","currentStyle","points","controlA","controlB","controls","r","rx","ry","begin","end","x1","y1","x2","y2","mask","maskId"].forEach(function(t){Object.defineProperty(r,t,{get:function(){return this.shadowRoot[t]}})}))}},{key:"render",value:function(){}},{key:"__destroy",value:function(){this.shadowRoot&&this.shadowRoot.__destroy(),this.children.splice(0),this.__shadowRoot=null,this.__parent=null}},{key:"__emitEvent",value:function(t,e){var i=this.shadowRoot;if(!(i instanceof U))return e?i.__emitEvent(t,e):i.__emitEvent(t)?(t.target=this,!0):void 0}},{key:"animate",value:function(t,e){var i=this.shadowRoot;i instanceof U||i.animate(t,e)}},{key:"__computed",value:function(){var t=this.shadowRoot;t instanceof U?(B.compute(t,!0),t.__measure()):t.__computed()}},{key:"__repaint",value:function(){var t=this.shadowRoot;t instanceof U?B.repaint(t,!0):t.__repaint()}},{key:"tagName",get:function(){return this.__tagName}},{key:"children",get:function(){return this.__children}},{key:"shadowRoot",get:function(){return this.__shadowRoot}},{key:"root",get:function(){if(this.parent)return this.parent.root}},{key:"parent",get:function(){return this.__parent}},{key:"ref",get:function(){return this.__ref}},{key:"state",get:function(){return this.__state},set:function(t){this.__state=t}}]),a}();["__layout","__layoutAbs","__tryLayInline","__offsetX","__offsetY","__calAutoBasis","__calMp","__calAbs","__renderAsMask","__renderByMask"].forEach(function(e){at.prototype[e]=function(){var t=this.shadowRoot;if(t[e])return t[e].apply(t,arguments)}});var ot,oe={measureText:function(t){var e=U.MEASURE_TEXT,i=e.list,r=e.data,n="",a=[],o=[];for(var s in r)if(r.hasOwnProperty(s)){var h=r[s],u=h.key,l=h.style,c=h.s;if(c)for(var f="position:absolute;font-family:".concat(l.fontFamily,";font-size:").concat(l.fontSize,"px"),_=0,d=c.length;_<d;_++){a.push(u);var p=c.charAt(_);o.push(p),n+='<span style="'.concat(f,'">').concat(p.replace(/</,"&lt;"),"</span>")}}if(n){var v=document.createElement("div");v.style.position="absolute",v.style.left="99999px",v.style.top="-99999px",v.style.visibility="hidden",document.body.appendChild(v),v.innerHTML=n;for(var g=v.childNodes,y=U.CHAR_WIDTH_CACHE,m=U.MEASURE_TEXT,k=0,b=g.length;k<b;k++){var x=g[k],w=a[k],A=o[k],E=window.getComputedStyle(x,null);y[w][A]=parseFloat(E.width)}i.forEach(function(t){return t.__measureCb()}),t(),m.list=[],m.data={},document.body.removeChild(v)}else t()},measureImg:function(t,e){var i=new Image;if(i.onload=function(){e({success:!0,width:i.width,height:i.height,source:i})},i.onerror=function(){e({success:!1})},"data:"!==t.substr(0,5)){var r=/^(?:\w+:)?\/\/([^/:]+)/.exec(t);r&&location.hostname!==r[1]&&(i.crossOrigin="anonymous")}i.src=t},warn:function(t){console.warn(t)},requestAnimationFrame:(ot=function(t){"undefined"!=typeof requestAnimationFrame?(oe.requestAnimationFrame=requestAnimationFrame.bind(window),requestAnimationFrame(t)):(setTimeout(t,16.7),oe.requestAnimationFrame=function(t){setTimeout(t,16.7)})},st.toString=function(){return ot.toString()},st),now:function(){return"undefined"!=typeof performance?(oe.now=performance.now.bind(performance),performance.now()):(oe.now=Date.now.bind(Date),Date.now())}};function st(t){return ot.apply(this,arguments)}var ht=new(function(){function t(){f(this,t),this.__inFrame=!1,this.__task=[],this.__afterFrame=[]}return s(t,[{key:"__init",value:function(a){var o=this;!function r(){var n=oe.now();oe.requestAnimationFrame(function(){if(a.length){var t=oe.now(),e=t-n;e*=.06,n=t,o.__inFrame=!0,a.forEach(function(t){return t(e)}),o.__inFrame=!1;var i=o.__afterFrame;i&&i.forEach(function(t){return t(e)}),o.__afterFrame=[],a.length&&r()}})}()}},{key:"onFrame",value:function(t){var e=this.task;e.length||this.__init(e),this.task.push(t)}},{key:"offFrame",value:function(t){for(var e=this.task,i=0,r=e.length;i<r;i++)if(e[i]===t){e.splice(i,1);break}}},{key:"nextFrame",value:function(t){var e=this;function i(){t(),e.offFrame(i)}e.__inFrame?(e.__afterFrame=e.__afterFrame||[],e.__afterFrame.push(i)):e.onFrame(i)}},{key:"task",get:function(){return this.__task}}]),t}()),ut=4,lt=1e-7,ct=10,ft="function"==typeof Float32Array;function _t(t,e){return 1-3*e+3*t}function dt(t,e){return 3*e-6*t}function pt(t){return 3*t}function vt(t,e,i){return((_t(e,i)*t+dt(e,i))*t+pt(e))*t}function gt(t,e,i){return 3*_t(e,i)*t*t+2*dt(e,i)*t+pt(e)}function yt(t){return t}function mt(a,e,o,i){if(!(0<=a&&a<=1&&0<=o&&o<=1))throw new Error("bezier x values must be in [0, 1] range");if(a===e&&o===i)return yt;for(var s=ft?new Float32Array(11):new Array(11),t=0;t<11;++t)s[t]=vt(.1*t,a,o);function r(t){for(var e=0,i=1;10!==i&&s[i]<=t;++i)e+=.1;var r=e+.1*((t-s[--i])/(s[i+1]-s[i])),n=gt(r,a,o);return.001<=n?function(t,e,i,r){for(var n=0;n<ut;++n){var a=gt(e,i,r);if(0===a)return e;e-=(vt(e,i,r)-t)/a}return e}(t,r,a,o):0===n?r:function(t,e,i,r,n){for(var a,o,s=0;0<(a=vt(o=e+(i-e)/2,r,n)-t)?i=o:e=o,Math.abs(a)>lt&&++s<ct;);return o}(t,e,e+.1,a,o)}return function(t){return 0===t||1===t?t:vt(r(t),e,i)}}var kt={linear:mt(1,1,0,0),easeIn:mt(.42,0,1,1),easeOut:mt(0,0,.58,1),ease:mt(.25,.1,.25,1),easeInOut:mt(.42,0,.58,1),cubicBezier:mt},bt={GEOM:{x1:!0,y1:!0,x2:!0,y2:!0,controlA:!0,controlB:!0,r:!0,rx:!0,ry:!0,begin:!0,end:!0,points:!0,controls:!0},STYLE:{transform:!0,color:!0,fontStyle:!0,strokeWidth:!0,fill:!0,backgroundColor:!0,backgroundImage:!0,backgroundPosition:!0,backgroundRepeat:!0,backgroundSize:!0,stroke:!0,borderBottomColor:!0,borderLeftColor:!0,borderRightColor:!0,borderTopColor:!0,visibility:!0,opacity:!0}},xt=["backgroundColor","borderBottomColor","borderLeftColor","borderRightColor","borderTopColor","color","fill","stroke"],wt=["backgroundImage","fill","stroke"],At={};xt.forEach(function(t){At[t]=!0});var Et={};["fontSize","borderBottomWidth","borderLeftWidth","borderRightWidth","borderTopWidth","bottom","left","right","top","flexBasis","width","height","lineHeight","marginBottom","marginLeft","marginRight","marginTop","paddingBottom","paddingLeft","paddingRight","paddingTop","strokeWidth"].forEach(function(t){Et[t]=!0});var Tt={};wt.forEach(function(t){Tt[t]=!0});var Mt={linear:!0,radial:!0};function Pt(i){xt.forEach(function(t){if(i.hasOwnProperty(t)){var e=i[t];Mt.hasOwnProperty(e.k)||(i[t]=ie.rgb2int(e))}}),wt.forEach(function(t){if(i.hasOwnProperty(t)){var e=i[t];Mt.hasOwnProperty(e.k)&&e.v.forEach(function(t){t[0]=ie.rgb2int(t[0])})}})}function St(t,e,i){if("transform"===t){if(e.length!==i.length)return!1;for(var r=0,n=e.length;r<n;r++){var a=e[r][0];if(a!==i[r][0])return!1;var o=e[r][1],s=i[r][1];if("matrix"===a){if(o[0]!==s[0]||o[1]!==s[1]||o[2]!==s[2]||o[3]!==s[3]||o[4]!==s[4]||o[5]!==s[5])return!1}else if(o.value!==s.value||o.unit!==s.unit)return!1}return!0}if("backgroundPositionX"===t||"backgroundPositionY"===t)return e.value===i.value&&e.unit===i.unit;if("transformOrigin"===t||"backgroundSize"===t)return e[0].value===i[0].value&&e[0].unit===i[0].unit&&e[1].value===i[1].value&&e[1].unit===i[1].unit;if(Et.hasOwnProperty(t))return e.value===i.value&&e.unit===i.unit;if(Tt.hasOwnProperty(t)&&e.k===i.k&&Mt.hasOwnProperty(e.k)){var h=e.v,u=i.v;if(e.d!==i.d||h.length!==u.length)return!1;for(var l=0,c=h.length;l<c;l++){var f=h[l],_=u[l];if(f.length!==_.length)return!1;for(var d=0;d<4;d++)if(f[0][d]!==_[0][d])return!1;if(1<f.length&&(f[1].value!==_[1].value||f[1].unit!==_[1].unit))return!1}return!0}if(bt.GEOM.hasOwnProperty(t)){if("points"===t||"controls"===t){if(e.length!==i.length)return!1;for(var p=0,v=e.length;p<v;p++)if(e[p]!==i[p]&&(e[p][0]!==i[p][0]||e[p][1]!==i[p][1]))return!1;return!0}if("controlA"===t||"controlB"===t)return e.length===i.length&&(e[0]===i[0]&&e[1]===i[1])}return e===i}function Ot(t,e,i){if(e){var r=!1;for(var n in t)if(t.hasOwnProperty(n)&&e.hasOwnProperty(n)){if(!St(n,t[n],e[n])){r=!0;break}}else if(t.hasOwnProperty(n)||e.hasOwnProperty(n)){r=!0;break}for(var a in e)if(e.hasOwnProperty(a)&&!t.hasOwnProperty(a)){r=!0;break}if(!r)return!1}var o=i.animateStyle;for(var s in t)if(t.hasOwnProperty(s)){var h=t[s];bt.GEOM.hasOwnProperty(s)?i["__"+s]=h:Tt.hasOwnProperty(s)&&Mt.hasOwnProperty(h.k)?o[s]={k:h.k,v:h.v.map(function(t){var e=[],i=t[0];return 1===i[3]?e.push("rgb(".concat(i[0],",").concat(i[1],",").concat(i[2],")")):e.push("rgba(".concat(i[0],",").concat(i[1],",").concat(i[2],",").concat(i[3],")")),t[1]&&e.push(ie.clone(t[1])),e}),d:h.d}:At.hasOwnProperty(s)?1===h[3]?o[s]="rgb(".concat(h[0],",").concat(h[1],",").concat(h[2],")"):o[s]="rgba(".concat(h[0],",").concat(h[1],",").concat(h[2],",").concat(h[3],")"):o[s]=h}return!0}function Rt(t,e){var i=e.style,r=e.animateStyle;t.forEach(function(t){r[t]=ie.clone(i[t])})}function Nt(t,e){var i=[],r={};for(var n in t)t.hasOwnProperty(n)&&!{offset:!0,easing:!0}.hasOwnProperty(n)&&(-1===i.indexOf(n)&&i.push(n),r[n]=t[n],e&&!e.hash.hasOwnProperty(n)&&(e.hash[n]=!0,e.keys.push(n)));return{style:r,offset:t.offset,easing:t.easing,keys:i,transition:[]}}function Ct(i,t,r,e){var n=Nt(t,e);return n.keys.forEach(function(t){var e=function(c,s,t,f){if(c.hasOwnProperty(t)&&s.hasOwnProperty(t)){var _={k:t},e=c[t],i=s[t];if("transform"===t){if(!c[t]||!s[t])return;var d={};e.forEach(function(t){d[t[0]]=t[1]});var p={};i.forEach(function(t){p[t[0]]=t[1]}),_.v=[];var v=t;i.forEach(function(t){var e=Jt(t,2),i=e[0],r=e[1];if(d.hasOwnProperty(i)){var n=d[i],a=p[i];if("matrix"===i){for(var o=[],s=0;s<6;s++)o[s]=a[s]-n[s];_.v.push({k:i,v:o})}else n.unit===a.unit?_.v.push({k:i,v:r.value-n.value}):n.unit===G.PX&&a.unit===G.PERCENT?("translateX"===i?n.value=100*n.value/f.outerWidth:"translateY"===i&&(n.value=100*n.value/f.outerHeight),n.unit=G.PERCENT,_.v.push({k:i,v:a.value-n.value})):n.unit===G.PERCENT&&a.unit===G.PX&&("translateX"===i?n.value=.01*n.value*f.outerWidth:"translateY"===i&&(n.value=.01*n.value*f.outerHeight),n.unit=G.PX,_.v.push({k:i,v:a.value-n.value}))}else if("matrix"===i){var h=[1,0,0,1,0,0];c[v].push([i,h]);for(var u=[],l=0;l<6;l++)u[l]=r[l]-h[l];_.v.push({k:i,v:u})}else c[v].push([i,{value:0,unit:r.unit}]),_.v.push({k:i,v:r.value})}),e.forEach(function(t){var e=Jt(t,2),i=e[0],r=e[1];if(!p.hasOwnProperty(i))if("matrix"===i){var n=[1,0,0,1,0,0];s[v].push([i,n]);for(var a=[],o=0;o<6;o++)a[o]=n[o]-r[o];_.v.push({k:i,v:a})}else s[v].push([i,{value:0,unit:r.unit}]),_.v.push({k:i,v:-r.value})})}else if("transformOrigin"===t){_.v=[];for(var r=0;r<2;r++){var n=e[r],a=i[r];n.unit===a.unit?_.v.push(a.value-n.value):n.unit===G.PX&&a.unit===G.PERCENT?(n.value=100*n.value/f[r?"outerHeight":"outerWidth"],_.v.push(a.value-n.value)):n.unit===G.PERCENT&&a.unit===G.PX?(n.value=.01*n.value*f[r?"outerHeight":"outerWidth"],_.v.push(a.value-n.value)):_.v.push(0)}}else if("backgroundPositionX"===t||"backgroundPositionY"===t)e.unit===i.unit&&-1<[G.PX,G.PERCENT].indexOf(e.unit)?_.v=i.value-e.value:_.v=0;else if("backgroundSize"===t){_.v=[];for(var o=0;o<2;o++){var h=e[o],u=i[o];h.unit===u.unit&&-1<[G.PX,G.PERCENT].indexOf(h.unit)?_.v.push(u.value-h.value):_.v.push(0)}}else if(Tt.hasOwnProperty(t)&&{linear:!0,radial:!0}.hasOwnProperty(e.k)&&e.k===i.k&&e.v.length&&e.v.length){var l=e.v,g=i.v;_.v=[];for(var y=0,m=Math.min(l.length,g.length);y<m;y++){var k=l[y],b=g[y],x=[];x.push([b[0][0]-k[0][0],b[0][1]-k[0][1],b[0][2]-k[0][2],b[0][3]-k[0][3]]),k[1]&&b[1]&&k[1].unit===b[1].unit&&(x.push(b[1].value-k[1].value),_.v.push(x))}"linear"===e.k&&void 0!==e.d&&void 0!==i.d&&(_.d=i.d-e.d)}else if(At.hasOwnProperty(t)){if(e.k!==i.k)return;_.v=[i[0]-e[0],i[1]-e[1],i[2]-e[2],i[3]-e[3]]}else if(Et.hasOwnProperty(t)){if(e.unit===G.AUTO||i.unit===G.AUTO)return;var w=(f.parent||f).computedStyle;if(e.unit===i.unit)_.v=i.value-e.value;else if(e.unit===G.PX&&i.unit===G.PERCENT)e.value=100*e.value/w[t],e.unit=G.PERCENT,_.v=i.value-e.value;else{if(e.unit!==G.PERCENT||i.unit!==G.PX)return;e.value=.01*e.value*w[t],e.unit=G.PX,_.v=i.value-e.value}}else if(bt.GEOM.hasOwnProperty(t))if("points"===t||"controls"===t){_.v=[];for(var A=0,E=Math.min(e.length,i.length);A<E;A++){var T=e[A],M=i[A];if(ie.isNil(T)||ie.isNil(M))_.v.push(T);else{for(var P=[],S=0,O=Math.max(T.length,M.length);S<O;S++)ie.isNil(T[S])||ie.isNil(M[S])?P.push(T[S]):P.push(M[S]-T[S]);_.v.push(P)}}}else _.v="controlA"===t||"controlB"===t?[i[0]-e[0],i[1]-e[1]]:i-e;else _.v="opacity"===t?i-e:e;return _}}(i.style,n.style,t,r);e&&i.transition.push(e)}),n}function Lt(t){for(var e in t)if(t.hasOwnProperty(e)&&!bt.STYLE.hasOwnProperty(e)&&!bt.GEOM.hasOwnProperty(e))return nt.REFLOW;return nt.REPAINT}var Wt=0,It=function(){function c(t,e,i){var r;if(f(this,c),(r=_(this,X(c).call(this))).__id=Wt++,r.__target=t,r.__list=ie.clone(e||[]),!Array.isArray(r.__list)){var n=[],a=r.__list;for(var o in a)if(a.hasOwnProperty(o)){var s=a[o];if(Array.isArray(s))for(var h=0,u=s.length;h<u;h++){(n[h]=n[h]||{offset:h/(u-1)})[o]=s[h]}}r.__list=n}ie.isNumber(i)&&(r.__options={duration:i},i=r.__options);var l=r.__options=i||{};return r.__duration=parseFloat(l.duration)||0,r.__delay=Math.max(0,parseFloat(l.delay)||0),r.__endDelay=Math.max(parseFloat(l.endDelay)||0,0),"Infinity"===l.iterations||"infinity"===l.iterations||l.iterations===1/0?r.__iterations=1/0:(r.__iterations=parseInt(l.iterations),isNaN(r.__iterations)&&(r.__iterations=1)),r.__fps=parseInt(l.fps)||60,r.__fps<0&&(r.__fps=60),r.__fill=l.fill||"none",r.__direction=l.direction||"normal",r.__frames=[],r.__framesR=[],r.__playbackRate=parseFloat(l.playbackRate)||1,r.__playbackRate<0&&(r.__playbackRate=1),r.__startTime=0,r.__offsetTime=0,r.__pauseTime=0,r.__lastFpsTime=0,r.__pending=!1,r.__playState="idle",r.__playCount=0,r.__cb=null,r.__isDestroyed=!0,r.__diffTime=0,r.__init(),r}return t(c,$),s(c,[{key:"__init",value:function(){var t=this,e=this.target,i=this.iterations,r=this.frames,n=this.framesR,a=this.direction,o=this.duration,s=ie.clone(e.style);if(!(i<1)){e.animateStyle!==e.currentStyle&&(e.__animateStyle=ie.clone(s)),Pt(s);for(var h=this.list,u=-1,l=0,c=h.length;l<c;l++){var f=h[l];f.hasOwnProperty("offset")?(f.offset=parseFloat(f.offset),isNaN(f.offset)||f.offset<0||1<f.offset?(h.splice(l,1),l--,c--):f.offset<=u?(h.splice(l,1),l--,c--):(u=f.offset,B.normalize(f),Pt(f))):(B.normalize(f),Pt(f))}if(!(h.length<2)){var _=h[0];_.offset=0;for(var d=h[h.length-1].offset=1,p=h.length;d<p;d++){var v=h[d];if(!v.offset){for(var g=void 0,y=d+1;y<p&&!(g=h[y]).offset;y++);var m=y-d+1;v=h[d-1];for(var k=(g.offset-v.offset)/m,b=d;b<y;b++){h[b].offset=v.offset+k*(b+1-d)}d=y}}var x,w=h.length,A=this.__record={keys:[],hash:{}};x=Nt(_,A),r.push(x);for(var E=1;E<w;E++){x=Ct(x,h[E],e,A),r.push(x)}if({reverse:!(this.__isDestroyed=!1),alternate:!0,"alternate-reverse":!0}.hasOwnProperty(a)){var T=ie.clone(h).reverse();T.forEach(function(t){t.offset=1-t.offset}),x=Nt(T[0]),n.push(x);for(var M=1;M<w;M++){x=Ct(x,T[M],e),n.push(x)}}this.__fin=function(){t.emit($.KARAS_ANIMATION_FRAME),t.emit($.KARAS_ANIMATION_FINISH)},r.forEach(function(t){t.time=o*t.offset}),n.forEach(function(t){t.time=o*t.offset})}}}},{key:"play",value:function(){var v=this;if(this.isDestroyed||this.duration<=0)return this;if(this.__cancelTask(),this.__playState="running",this.pending){var t=oe.now()-this.pauseTime;t=Math.max(t,0),this.__offsetTime=t}else{var g=this.frames,y=this.framesR,m=this.target,k=this.playCount,b=this.duration,x=this.direction,w=this.iterations,A=this.fill,E=this.delay,T=this.endDelay,M=this.__fin,P=this.__record,S=g.length,O=!0,R=!0;this.__cb=function(){var i=v.playbackRate,r=v.offsetTime,n=oe.now(),a=m.root;O&&(v.__startTime=v.__lastFpsTime=v.__lastTime=n,v.__lastIndex=0);var t=n-v.__lastTime-r;if(t=Math.max(t,0),1!==i&&(t*=i),v.__diffTime+=t,t=v.__diffTime,v.__lastTime=n,0<k&&(E=0),t<E){if(O&&{backwards:!0,both:!0}.hasOwnProperty(A)){var e=g[0],o=Ot(e.style,{},m),s=v.__task=function(){v.emit($.KARAS_ANIMATION_FRAME)};o&&(a.setRefreshLevel(Lt(e.style)),a.addRefreshTask(s))}O=!1}else{var h;if(O=!1,"reverse"===x)h=y;else if({alternate:!0,"alternate-reverse":!0}.hasOwnProperty(x)){var u=k%2==0;h="alternate"===x?u?g:y:u?y:g}else h=g;t-=E;var l,c=function t(e,i,r,n){if(e===i)return n[e].time>r?e-1:e;var a=e+(i-e>>1),o=n[a];return o.time===r?a:o.time>r?t(e,Math.max(a-1,e),r,n):t(Math.min(a+1,i),i,r,n)}(0,h.length-1,t,h),f=h[c];if(c===S-1)l=Ot(f.style,v.__lastStyle,m),k<w&&(k=++v.playCount,v.__diffTime=0);else{var _=v.fps;if((!ie.isNumber(_)||_<0)&&(_=60),!R&&_<60)if(n-v.__lastFpsTime<1e3/_)return;var d=h[c+1].time-f.time;l=Ot(function(t,v){var g=ie.clone(t.style),e=kt[t.easing]||kt.linear;return e!==kt.linear&&(v=e(v)),v=Math.max(v,0),v=Math.min(v,1),t.transition.forEach(function(t){var e=t.k,i=t.v,r=t.d,n=g[e];if("transform"===e){var a=g.transform,o={};a.forEach(function(t){o[t[0]]=t[1]}),i.forEach(function(t){var e=t.k,i=t.v;if("matrix"===e)for(var r=0;r<6;r++)o[e][r]+=i[r]*v;else o[e].value+=i*v})}else if("backgroundPositionX"===e||"backgroundPositionY"===e)0!==i&&(n.value+=i*v);else if("transformOrigin"===e||"backgroundSize"===e)0!==i[0]&&(n[0].value+=i[0]*v),0!==i[1]&&(n[1].value+=i[1]*v);else if(Tt.hasOwnProperty(e)&&Mt.hasOwnProperty(n.k)){for(var s=0,h=Math.min(n.v.length,i.length);s<h;s++){var u=n.v[s],l=i[s];u[0][0]+=l[0][0]*v,u[0][1]+=l[0][1]*v,u[0][2]+=l[0][2]*v,u[0][3]+=l[0][3]*v,u[1]&&l[1]&&(u[1].value+=l[1]*v)}"linear"===n.k&&void 0!==n.d&&void 0!==r&&(n.d+=r*v)}else if(At.hasOwnProperty(e))n[0]+=i[0]*v,n[1]+=i[1]*v,n[2]+=i[2]*v,n[3]+=i[3]*v;else if(Et.hasOwnProperty(e))g[e].value+=i*v;else if(bt.GEOM.hasOwnProperty(e)){var c=g[e];if("points"===e||"controls"===e){for(var f=0,_=Math.min(c.length,i.length);f<_;f++)if(!ie.isNil(c[f])&&c[f].length)for(var d=0,p=Math.min(c[f].length,i[f].length);d<p;d++)ie.isNil(c[f][d])||ie.isNil(i[f][d])||(c[f][d]+=i[f][d]*v)}else"controlA"===e||"controlB"===e?(c[0]+=i[0]*v,c[1]+=i[1]*v):g[e]+=i*v}else"opacity"===e?g[e]+=i*v:g[e]=i}),g}(f,(t-f.time)/d),v.__lastStyle,m)}if(v.__lastFpsTime=n,v.__lastStyle=f.style,R=!1,a){var p=v.__task=function(){if(v.emit($.KARAS_ANIMATION_FRAME),c===S-1){if(w===1/0||k<w)return;if(ht.offFrame(v.cb),{forwards:!0,both:!0}.hasOwnProperty(A)||(a.setRefreshLevel(Lt(P.hash)),Rt(P.keys,m)),b+T<=t)v.__playState="finished",a.addRefreshTask(v.__task=M);else{var e=v.__task=function(){var t=(n=oe.now())-v.__lastTime-r-E;t=Math.max(t,0),1!==i&&(t*=i),v.__diffTime+=t,t=v.__diffTime,v.__lastTime=n,b+T<=t&&(v.__playState="finished",a.addRefreshTask(v.__task=M),ht.offFrame(e))};ht.onFrame(e)}}};l?(a.setRefreshLevel(Lt(f.style)),a.addRefreshTask(p)):ht.nextFrame(p)}}}}return this.cb(),ht.offFrame(this.cb),ht.onFrame(this.cb),this.__pending=!1,this}},{key:"pause",value:function(){return this.__pending=!0,this.__pauseTime=oe.now(),this.__playState="paused",ht.offFrame(this.cb),this.__cancelTask(),this.emit($.KARAS_ANIMATION_PAUSE),this}},{key:"finish",value:function(){var t=this.fill,e=this.playState,i=this.__fin,r=this.__record;if("finished"===e)return this;ht.offFrame(this.cb),this.__cancelTask();var n=this.target,a=this.lastStyle,o=n.root;if(o)if(this.__playState="finished",{forwards:!0,both:!0}.hasOwnProperty(t)){var s=this.frames[this.frames.length-1];Ot(s.style,a,this.target)?(o.setRefreshLevel(Lt(s.style)),o.addRefreshTask(this.__task=i)):ht.nextFrame(this.__task=i)}else o.setRefreshLevel(Lt(r.hash)),Rt(r.keys,n),o.addRefreshTask(this.__task=i);return this}},{key:"cancel",value:function(){var t=this;if(ht.offFrame(this.cb),this.__cancelTask(),"idle"===this.__playState)return this;this.__playState="idle";var e=this.target.root;if(e){var i=this.__task=function(){t.emit($.KARAS_ANIMATION_CANCEL)};e.addRefreshTask(i)}return this}},{key:"__cancelTask",value:function(){var t=this.target,e=this.__task;t.root&&e&&t.root.delRefreshTask(e)}},{key:"__destroy",value:function(){ht.offFrame(this.cb),this.__cancelTask(),this.__playState="idle",this.__isDestroyed=!0}},{key:"id",get:function(){return this.__id}},{key:"target",get:function(){return this.__target}},{key:"list",get:function(){return this.__list}},{key:"options",get:function(){return this.__options}},{key:"duration",get:function(){return this.__duration}},{key:"delay",get:function(){return this.__delay}},{key:"endDelay",get:function(){return this.__endDelay}},{key:"fps",get:function(){return this.__fps},set:function(t){(t=parseInt(t)||60)<0&&(t=60),this.__fps=t}},{key:"iterations",get:function(){return this.__iterations}},{key:"fill",get:function(){return this.__fill}},{key:"direction",get:function(){return this.__direction}},{key:"frames",get:function(){return this.__frames}},{key:"framesR",get:function(){return this.__framesR}},{key:"playbackRate",get:function(){return this.__playbackRate},set:function(t){(t=parseFloat(t)||0)<0&&(t=1),this.__playbackRate=t}},{key:"startTime",get:function(){return this.__startTime}},{key:"pending",get:function(){return this.__pending}},{key:"offsetTime",get:function(){return this.__offsetTime}},{key:"pauseTime",get:function(){return this.__pauseTime}},{key:"playState",get:function(){return this.__playState}},{key:"playCount",get:function(){return this.__playCount},set:function(t){this.__playCount=t}},{key:"cb",get:function(){return this.__cb}},{key:"isDestroyed",get:function(){return this.__isDestroyed}},{key:"lastStyle",get:function(){return this.__lastStyle}}]),c}();function se(t,e,r,n,i){if(t===ee.CANVAS)e.forEach(function(t){n.beginPath(),n.fillStyle=r,n.moveTo(t[0],t[1]);for(var e=2,i=t.length;e<i;e+=2)n.lineTo(t[e],t[e+1]);n.fill(),n.closePath()});else if(t===ee.SVG){var a="";e.forEach(function(t){a+="M ".concat(t[0]," ").concat(t[1]);for(var e=2,i=t.length;e<i;e+=2)a+="L ".concat(t[e]," ").concat(t[e+1]," ")}),i.addBorder([["d",a],["fill",r]])}}function he(t,e,i,r,n,a,o,s){t===ee.CANVAS?(o.beginPath(),o.fillStyle=e,o.rect(i,r,n,a),o.fill(),o.closePath()):t===ee.SVG&&s.addBackground([["x",i],["y",r],["width",n],["height",a],["fill",e]])}function ue(t,i,r,n,a){var o=[];return t.forEach(function(t,e){t.unit===G.PX?o.push(t.value):t.unit===G.PERCENT?o.push((e?r:i)+t.value*(e?a:n)*.01):t.unit===G.AUTO?o.push(-1):t.unit===G.SIZE?o.push("contain"===t.value?-2:-3):t.unit===G.POSITION&&o.push(t.value)}),o}function le(t,e,i){return"right"===t.value||"bottom"===t.value?e-i:"center"===t.value?.5*(e-i):t.unit===G.PX?t.value:t.unit===G.PERCENT?(e-i)*t.value*.01:0}var Ft=function(){function g(t,e){var r;return f(this,g),r=_(this,X(g).call(this)),e=e||[],Array.isArray(e)?(r.props=ie.arr2hash(e),r.__props=e):(r.props=e,r.__props=ie.hash2arr(e)),r.__tagName=t,r.__style=r.props.style||{},r.__animateStyle={},r.__listener={},r.__props.forEach(function(t){var e=t[0],i=t[1];/^on[a-zA-Z]/.test(e)?(e=e.slice(2).toLowerCase(),(r.__listener[e]=r.__listener[e]||[]).push(i)):"id"===e&&i?r.__id=i:-1<["class","className"].indexOf(e)&&i&&(i=Y.splitClass(i))&&(r.__class=i)}),r.__matrix=null,r.__matrixEvent=null,r.__animationList=[],r.__loadBgi={},r}return t(g,l),s(g,[{key:"__traverseCss",value:function(e,i){this.isGeom()||this.children.forEach(function(t){(t instanceof g||t instanceof at)&&t.__traverseCss(e,i)});var t=Y.parse(this,e,i)||{};for(var r in t)t.hasOwnProperty(r)&&!this.__style.hasOwnProperty(r)&&(this.__style[r]=t[r])}},{key:"__measure",value:function(){var t=this.children;t&&t.forEach(function(t){t instanceof g?t.__measure():t instanceof at?t.shadowRoot.__measure():t.__measure()})}},{key:"__mp",value:function(t,e,i){var r=t.marginTop,n=t.marginRight,a=t.marginBottom,o=t.marginLeft,s=t.paddingTop,h=t.paddingRight,u=t.paddingBottom,l=t.paddingLeft;e.marginLeft=this.__mpWidth(o,i),e.marginTop=this.__mpWidth(r,i),e.marginRight=this.__mpWidth(n,i),e.marginBottom=this.__mpWidth(a,i),e.paddingLeft=this.__mpWidth(l,i),e.paddingTop=this.__mpWidth(s,i),e.paddingRight=this.__mpWidth(h,i),e.paddingBottom=this.__mpWidth(u,i)}},{key:"__mpWidth",value:function(t,e){return t.unit===G.PX?t.value:t.unit===G.PERCENT?t.value*e*.01:0}},{key:"__layout",value:function(t,e){var i=t.w,r=this.isDestroyed,n=this.currentStyle,a=this.computedStyle,o=n.display,s=n.width;if(s.unit!==G.AUTO)switch(s.unit){case G.PX:i=s.value;break;case G.PERCENT:i*=.01*s.value}if(this.__mp(n,a,i),this.__ox=this.__oy=0,r||"none"===o)a.width=a.height=0;else{if("block"===o?this.__layoutBlock(t,e):"flex"===o?this.__layoutFlex(t,e):"inline"===o&&this.__layoutInline(t,e),"relative"===n.position&&this.parent){var h=n.top,u=n.right,l=n.bottom,c=n.left,f=this.parent;if(h.unit!==G.AUTO){var _=B.calRelative(n,"top",h,f);this.__offsetY(_),a.top=_,a.bottom="auto"}else if(l.unit!==G.AUTO){var d=B.calRelative(n,"bottom",l,f);this.__offsetY(-d),a.bottom=d,a.top="auto"}else a.top=a.bottom="auto";if(c.unit!==G.AUTO){var p=B.calRelative(n,"left",c,f,!0);this.__offsetX(p),a.left=p,a.right="auto"}else if(u.unit!==G.AUTO){var v=B.calRelative(n,"right",u,f,!0);this.__offsetX(-v),a.right=v,a.left="auto"}else a.left=a.right="auto"}a.width=this.width,a.height=this.height}}},{key:"isGeom",value:function(){return"$"===this.tagName.charAt(0)}},{key:"isRoot",value:function(){return!this.parent}},{key:"__preLayout",value:function(t){var e=t.x,i=t.y,r=t.w,n=t.h;this.__x=e,this.__y=i;var a,o,s=this.currentStyle,h=this.computedStyle,u=s.width,l=s.height,c=h.borderTopWidth,f=h.borderRightWidth,_=h.borderBottomWidth,d=h.borderLeftWidth,p=h.marginTop,v=h.marginRight,g=h.marginBottom,y=h.marginLeft,m=h.paddingTop,k=h.paddingRight,b=h.paddingBottom,x=h.paddingLeft;if(u.unit!==G.AUTO)switch(a=!0,u.unit){case G.PX:r=u.value;break;case G.PERCENT:r*=.01*u.value}if(l.unit!==G.AUTO)switch(o=!0,l.unit){case G.PX:n=l.value;break;case G.PERCENT:n*=.01*l.value}return e+=d+y+x,t.x=e,i+=c+p+m,t.y=i,u.unit===G.AUTO&&(r-=d+f+y+v+x+k),l.unit===G.AUTO&&(n-=c+_+p+g+m+b),{fixedWidth:a,fixedHeight:o,x:e,y:i,w:r,h:n}}},{key:"render",value:function(t){var e=this;(this.__renderMode=t)===ee.SVG&&(this.__virtualDom={bb:[],children:[],transform:[],opacity:1});var i=this.isDestroyed,r=this.ctx,n=this.currentStyle,a=this.computedStyle,o=this.width,s=this.height,h=this.innerWidth,u=this.innerHeight,l=this.outerWidth,c=this.outerHeight;this.__matrix=this.__matrixEvent=null;for(var f=this.parent,_=[1,0,0,1,0,0];f;){if(f.matrixEvent){_=re.mergeMatrix(f.matrixEvent,_);break}f=f.parent}1===_[0]&&0===_[1]&&0===_[1]&&1===_[1]&&0===_[1]&&0===_[1]||(t===ee.CANVAS?this.__matrix=this.__matrixEvent=_:t===ee.SVG&&(this.__matrixEvent=_)),t===ee.CANVAS&&r.setTransform.apply(r,te(_));var d=a.display,p=a.marginTop,v=(a.marginRight,a.marginBottom,a.marginLeft),g=a.paddingTop,y=a.paddingRight,m=a.paddingBottom,k=a.paddingLeft,b=a.backgroundColor,x=a.borderTopWidth,w=a.borderTopColor,A=a.borderTopStyle,E=a.borderRightWidth,T=a.borderRightColor,M=a.borderRightStyle,P=a.borderBottomWidth,S=a.borderBottomColor,O=a.borderBottomStyle,R=a.borderLeftWidth,N=a.borderLeftColor,C=a.borderLeftStyle,L=a.visibility,W=n.backgroundImage,I=n.backgroundSize,F=n.backgroundPositionX,B=n.backgroundPositionY,D=n.backgroundRepeat,X=n.transform,H=n.transformOrigin,G=n.opacity,U=this.sx,j=this.sy,z=U+v,V=z+R,Y=V+o+k+y,$=Y+E,q=j+p,K=q+x,Z=K+s+g+m,Q=Z+P;f=this.parent;for(var J=G;f;)J*=f.currentStyle.opacity,f=f.parent;t===ee.CANVAS?r.globalAlpha=J:this.__virtualDom.opacity=G;var tt=re.calOrigin(H,U,j,l,c);if(a.transformOrigin=tt.join(" "),X){var et=re.calMatrix(X,tt,U,j,l,c);this.__matrix=this.matrix?re.mergeMatrix(this.matrix,et):et,a.transform="matrix("+et.join(", ")+")";for(var it=this.parent;it;){if(it.matrixEvent){et=re.mergeMatrix(it.matrixEvent,et);break}it=it.parent}this.__matrixEvent=et,t===ee.CANVAS?r.setTransform.apply(r,te(et)):t===ee.SVG&&this.addTransform(["matrix",this.matrix.join(",")])}else a.transform="matrix(1, 0, 0, 1, 0, 0)";if(!i&&"none"!==d&&"hidden"!==L){if("transparent"!==b&&he(t,b,V,K,h,u,r,this),W){if(ie.isString(W))if(this.__loadBgi.url===W){I=ue(I,V,K,h,u);var rt=this.__loadBgi,nt=rt.width,at=rt.height,ot=Jt(I,2),st=ot[0],ht=ot[1];-1===st&&-1===ht?(st=nt,ht=at):-2===st?h<nt&&u<at?(ht=at/u)<=(st=nt/h)?ht=(st=h)*at/nt:st=(ht=u)*nt/at:h<nt?ht=(st=h)*at/nt:u<at?st=(ht=u)*nt/at:(st=nt,ht=at):-3===st?nt<h&&at<u?(st=nt/h)<=(ht=at/u)?ht=(st=h)*at/nt:st=(ht=u)*nt/at:nt<h?ht=(st=h)*at/nt:at<u?st=(ht=u)*nt/at:(st=nt/h)<=(ht=at/u)?ht=(st=h)*at/nt:st=(ht=u)*nt/at:-1===st?st=ht*nt/at:-1===ht&&(ht=st*at/nt);var ut=V+le(F,h,nt),lt=K+le(B,u,at),ct=0,ft=0,_t=0,dt=0;if(-1<["repeat-x","repeat"].indexOf(D)){var pt=ut-V;0<pt&&(ct=Math.ceil(pt/st)),0<(pt=V+h-ut-st)&&(ft=Math.ceil(pt/st))}if(-1<["repeat-y","repeat"].indexOf(D)){var vt=lt-K;0<vt&&(_t=Math.ceil(vt/ht)),0<(vt=K+u-lt-ht)&&(dt=Math.ceil(vt/ht))}var gt=-1<["repeat-x","repeat-y","repeat"].indexOf(D)||ut<V||lt<K||h<st||u<ht;if(t===ee.CANVAS&&this.__loadBgi.source){var yt,mt;if(gt&&(yt=this.root.__getImageData(),this.root.__clear()),r.drawImage(this.__loadBgi.source,ut,lt,st,ht),0<ct||0<_t)for(var kt=0;kt<=Math.max(ct,1);kt++)for(var bt=0;bt<=Math.max(_t,1);bt++)0===kt&&0===bt||r.drawImage(this.__loadBgi.source,ut-kt*st,lt-bt*ht,st,ht);if(0<ft||0<_t)for(var xt=0;xt<=Math.max(ft,1);xt++)for(var wt=0;wt<=Math.max(_t,1);wt++)0===xt&&0===wt||r.drawImage(this.__loadBgi.source,ut+xt*st,lt-wt*ht,st,ht);if(0<ct||0<dt)for(var At=0;At<=Math.max(ct,1);At++)for(var Et=0;Et<=Math.max(dt,1);Et++)0===At&&0===Et||r.drawImage(this.__loadBgi.source,ut-At*st,lt+Et*ht,st,ht);if(0<ft||0<dt)for(var Tt=0;Tt<=Math.max(ft,1);Tt++)for(var Mt=0;Mt<=Math.max(dt,1);Mt++)0===Tt&&0===Mt||r.drawImage(this.__loadBgi.source,ut+Tt*st,lt+Mt*ht,st,ht);gt&&(r.globalCompositeOperation="destination-in",he(t,"#FFF",V,K,h,u,r,this),mt=this.root.__getImageData(),this.root.__clear(),r.globalCompositeOperation="source-over",this.root.__putImageData(ie.mergeImageData(yt,mt)))}else if(t===ee.SVG){var Pt=ae.matrixResize(nt,at,st,ht,V,K,h,u),St=[["xlink:href",W],["x",ut],["y",lt],["width",nt||0],["height",at||0]];if(Pt&&St.push(["transform","matrix("+Pt.join(",")+")"]),gt){var Ot=this.defs.add({tagName:"mask",props:[],children:[{tagName:"rect",props:[["x",V],["y",K],["width",h],["height",u],["fill","#FFF"]]}]});this.virtualDom.bbMask="url(#".concat(Ot,")")}if(this.virtualDom.bb.push({type:"img",tagName:"image",props:St}),0<ct||0<_t)for(var Rt=0;Rt<=Math.max(ct,1);Rt++)for(var Nt=0;Nt<=Math.max(_t,1);Nt++)if(0!==Rt||0!==Nt){var Ct=ie.clone(St);Ct[1][1]=ut-Rt*st,Ct[2][1]=lt-Nt*ht,this.virtualDom.bb.push({type:"img",tagName:"image",props:Ct})}if(0<ft||0<_t)for(var Lt=0;Lt<=Math.max(ft,1);Lt++)for(var Wt=0;Wt<=Math.max(_t,1);Wt++)if(0!==Lt||0!==Wt){var It=ie.clone(St);It[1][1]=ut+Lt*st,It[2][1]=lt-Wt*ht,this.virtualDom.bb.push({type:"img",tagName:"image",props:It})}if(0<ct||0<dt)for(var Ft=0;Ft<=Math.max(ct,1);Ft++)for(var Bt=0;Bt<=Math.max(dt,1);Bt++)if(0!==Ft||0!==Bt){var Dt=ie.clone(St);Dt[1][1]=ut-Ft*st,Dt[2][1]=lt+Bt*ht,this.virtualDom.bb.push({type:"img",tagName:"image",props:Dt})}if(0<ft||0<dt)for(var Xt=0;Xt<=Math.max(ft,1);Xt++)for(var Ht=0;Ht<=Math.max(dt,1);Ht++)if(0!==Xt||0!==Ht){var Gt=ie.clone(St);Gt[1][1]=ut+Xt*st,Gt[2][1]=lt+Ht*ht,this.virtualDom.bb.push({type:"img",tagName:"image",props:Gt})}}a.backgroundSize="".concat(st," ").concat(ht),a.backgroundPositionX=ut,a.backgroundPositionY=lt,a.backgroundRepeat=D}else this.__loadBgi.url=W,oe.measureImg(W,function(t){t.success&&(e.__loadBgi.source=t.source,e.__loadBgi.width=t.width,e.__loadBgi.height=t.height,e.root.addRefreshTask())});else if(W.k){he(t,this.__gradient(t,V,K,Y,Z,h,u,"backgroundImage",W,a),V,K,h,u,r,this)}}else{var Ut=V+le(F,h,0),jt=K+le(B,u,0);a.backgroundSize=ue(I,V,K,h,u).join(" "),a.backgroundPositionX=Ut,a.backgroundPositionY=jt,a.backgroundRepeat=D}if(0<x&&"transparent"!==w){var zt=Math.atan(x/R),Vt=Math.atan(x/E);se(t,ne.calPoints(x,A,zt,Vt,z,V,Y,$,q,K,Z,Q,0),w,r,this)}if(0<E&&"transparent"!==T){var Yt=Math.atan(E/x),$t=Math.atan(E/P);se(t,ne.calPoints(E,M,Yt,$t,z,V,Y,$,q,K,Z,Q,1),T,r,this)}if(0<P&&"transparent"!==S){var qt=Math.atan(P/R),Kt=Math.atan(P/E);se(t,ne.calPoints(P,O,qt,Kt,z,V,Y,$,q,K,Z,Q,2),S,r,this)}if(0<R&&"transparent"!==N){var Zt=Math.atan(R/x),Qt=Math.atan(R/P);se(t,ne.calPoints(R,C,Zt,Qt,z,V,Y,$,q,K,Z,Q,3),N,r,this)}}}},{key:"__renderByMask",value:function(t){var e,i,r=this.prev,n=r&&r.isMask;t===ee.CANVAS?(n&&(e=this.root.__getImageData(),this.root.__clear()),this.render(t),n&&(this.ctx.globalCompositeOperation="destination-in",r.render(t),i=this.root.__getImageData(),this.root.__clear()),this.ctx.globalCompositeOperation="source-over",n&&this.root.__putImageData(ie.mergeImageData(e,i))):t===ee.SVG&&(this.render(t),n&&(this.virtualDom.mask=r.maskId))}},{key:"__destroy",value:function(){var t=this.props.ref;if(t){var e=this.host||this.root;e&&e.ref[t]&&delete e.ref[t]}this.animationList.forEach(function(t){return t.__destroy()}),H(X(g.prototype),"__destroy",this).call(this),this.__matrix=this.__matrixEvent=null}},{key:"__emitEvent",value:function(e,t){var i=e.event.type,r=this.isDestroyed,n=this.listener,a=this.children,o=this.computedStyle;this.outerWidth,this.outerHeight,this.matrixEvent;if(!r&&"none"!==o.display&&!e.__stopPropagation){var s,h;if(n.hasOwnProperty(i)&&(s=n[i]),t){if(!this.isGeom()){for(var u=a.length-1;0<=u;u--){var l=a[u];(l instanceof g||l instanceof at)&&-1<["absolute","relative"].indexOf(l.computedStyle.position)&&l.__emitEvent(e,t)&&(h=!0)}for(var c=a.length-1;0<=c;c--){var f=a[c];(f instanceof g||f instanceof at)&&-1<["absolute","relative"].indexOf(f.computedStyle.position)&&f.__emitEvent(e,t)&&(h=!0)}}if(!h&&this.root.__touchstartTarget!==this)return;if(e.__stopPropagation)return;return"touchmove"!==i&&"touchend"!==i&&"touchcancel"!==i||(e.target=this.root.__touchstartTarget),s&&s.forEach(function(t){e.__stopImmediatePropagation||t(e)}),!0}if(!this.isGeom()){for(var _=a.length-1;0<=_;_--){var d=a[_];(d instanceof g||d instanceof at)&&-1<["absolute","relative"].indexOf(d.computedStyle.position)&&d.__emitEvent(e)&&(h=!0)}for(var p=a.length-1;0<=p;p--){var v=a[p];(v instanceof g||v instanceof at)&&-1===["absolute","relative"].indexOf(v.computedStyle.position)&&v.__emitEvent(e)&&(h=!0)}}if(!e.__stopPropagation)return h||this.willResponseEvent(e)?(e.__hasEmitted=!0,s&&s.forEach(function(t){e.__stopImmediatePropagation||ie.isFunction(t)&&t(e)}),!0):void 0}}},{key:"willResponseEvent",value:function(t){var e=t.x,i=t.y;if(!t.__hasEmitted){var r=this.sx,n=this.sy,a=this.outerWidth,o=this.outerHeight,s=this.matrixEvent;return re.pointInQuadrilateral(e-r,i-n,0,0,a,0,0,o,a,o,s)?(t.target||(t.target=this,"touchstart"===t.event.type&&(this.root.__touchstartTarget=this)),!0):void 0}}},{key:"__gradient",value:function(t,e,i,r,n,a,o,s,h,u){var l=h.k,c=h.v,f=h.d;u[s]=l+"-gradient(";var _,d=e+.5*a,p=i+.5*o;if("linear"===l){var v=E.getLinear(c,f,d,p,a,o);_=this.__getLg(t,v),u[s]+=f+"deg"}else if("radial"===l){var g=E.getRadial(c,f,d,p,e,i,r,n);_=this.__getRg(t,g),u[s]+=f}return c.forEach(function(t){u[s]+=", "+t[0],t[1]&&(u[s]+=" "+t[1].str)}),u[s]+=")",_}},{key:"__getLg",value:function(t,e){if(t===ee.CANVAS){var i=this.ctx.createLinearGradient(e.x1,e.y1,e.x2,e.y2);return e.stop.forEach(function(t){i.addColorStop(t[1],t[0])}),i}if(t===ee.SVG){var r=this.defs.add({tagName:"linearGradient",props:[["x1",e.x1],["y1",e.y1],["x2",e.x2],["y2",e.y2]],children:e.stop.map(function(t){return{tagName:"stop",props:[["stop-color",t[0]],["offset",100*t[1]+"%"]]}})});return"url(#".concat(r,")")}}},{key:"__getRg",value:function(t,e){if(t===ee.CANVAS){var i=this.ctx.createRadialGradient(e.cx,e.cy,0,e.cx,e.cy,e.r);return e.stop.forEach(function(t){i.addColorStop(t[1],t[0])}),i}if(t===ee.SVG){var r=this.defs.add({tagName:"radialGradient",props:[["cx",e.cx],["cy",e.cy],["r",e.r]],children:e.stop.map(function(t){return{tagName:"stop",props:[["stop-color",t[0]],["offset",100*t[1]+"%"]]}})});return"url(#".concat(r,")")}}},{key:"addBorder",value:function(t){this.virtualDom.bb.push({type:"item",tagName:"path",props:t})}},{key:"addBackground",value:function(t){this.virtualDom.bb.push({type:"item",tagName:"rect",props:t})}},{key:"addTransform",value:function(t){this.virtualDom.transform.push(t)}},{key:"animate",value:function(t,e){var i=new It(this,t,e);return this.animationList.push(i),i.play()}},{key:"__computed",value:function(){var e=this;B.compute(this,this.isRoot()),this.isGeom()||this.children.forEach(function(t){t instanceof g||t instanceof at?t.__computed():(t.__style=e.currentStyle,B.compute(t),t.__measure())})}},{key:"__repaint",value:function(){var e=this;B.repaint(this,this.isRoot()),this.isGeom()||this.children.forEach(function(t){t instanceof g||t instanceof at?t.__repaint():(t.__style=e.currentStyle,B.repaint(t))})}},{key:"tagName",get:function(){return this.__tagName}},{key:"innerWidth",get:function(){var t=this.computedStyle,e=t.paddingRight,i=t.paddingLeft;return this.width+i+e}},{key:"innerHeight",get:function(){var t=this.computedStyle,e=t.paddingTop,i=t.paddingBottom;return this.height+e+i}},{key:"outerWidth",get:function(){var t=this.computedStyle,e=t.borderLeftWidth,i=t.borderRightWidth,r=t.marginRight,n=t.marginLeft;return this.innerWidth+e+i+n+r}},{key:"outerHeight",get:function(){var t=this.computedStyle,e=t.borderTopWidth,i=t.borderBottomWidth,r=t.marginTop,n=t.marginBottom;return this.innerHeight+e+i+r+n}},{key:"listener",get:function(){return this.__listener}},{key:"renderMode",get:function(){return this.__renderMode}},{key:"matrix",get:function(){return this.__matrix}},{key:"matrixEvent",get:function(){return this.__matrixEvent}},{key:"id",get:function(){return this.__id}},{key:"class",get:function(){return this.__class||[]}},{key:"animationList",get:function(){return this.__animationList}},{key:"animateStyle",get:function(){return this.__animateStyle}},{key:"currentStyle",get:function(){for(var t=this.style,e=this.animateStyle,i=this.animationList,r=0,n=i.length;r<n;r++){var a=i[r],o=a.playState,s=a.options;if("idle"!==o&&("finished"!==o||-1!==["forwards","both"].indexOf(s.fill)))return e}return t}}]),g}(),Bt=function(){function i(t,e){f(this,i),this.__list=[],this.__x=t,this.__y=e,this.__baseLine=0}return s(i,[{key:"add",value:function(t){this.list.push(t)}},{key:"__calBaseLine",value:function(){var e=0;return this.list.forEach(function(t){e=Math.max(e,t.baseLine)}),e}},{key:"verticalAlign",value:function(){var i=this.__baseLine=this.__calBaseLine();1<this.list.length&&this.list.forEach(function(t){var e=t.baseLine;e!==i&&t.__offsetY(i-e)})}},{key:"horizonAlign",value:function(e){this.list.forEach(function(t){t.__offsetX(e)})}},{key:"list",get:function(){return this.__list}},{key:"x",get:function(){return this.__x}},{key:"y",get:function(){return this.__y}},{key:"width",get:function(){var e=0;return this.list.forEach(function(t){e+=t.width}),e}},{key:"height",get:function(){var e=0;return this.list.forEach(function(t){e=Math.max(e,t.height)}),e}},{key:"baseLine",get:function(){return this.__baseLine}},{key:"size",get:function(){return this.__list.length}}]),i}(),Dt={},Xt=function(){function r(t,e){var i;return f(this,r),(i=_(this,X(r).call(this,t,e))).__isMask=!ie.isNil(i.props.mask)||!0===i.props.mask,i}return t(r,Ft),s(r,[{key:"__init",value:function(){var t=this.style;this.isMask&&(t.position="absolute",t.display="block",t.visibility="visible",t.background=null,t.border=null,t.strokeWidth=0),B.normalize(t,rt.geom);var e=this.props.ref;if(e){var i=this.host||this.root;i&&(i.ref[e]=this)}}},{key:"__tryLayInline",value:function(t,e){var i=this.currentStyle.width;return i.unit===G.PX?t-i.value:i.unit===G.PERCENT?t-e*i.value*.01:t}},{key:"__calAutoBasis",value:function(t){var e=0,i=0,r=0,n=this.currentStyle,a=this.computedStyle,o=n.width,s=n.height,h=a.borderTopWidth,u=a.borderRightWidth,l=a.borderBottomWidth,c=a.borderLeftWidth,f=t?o:s;if(f.unit!==G.AUTO&&(e=r+=f.value),t){var _=u+c;e+=_,r+=_,i+=_}else{var d=h+l;e+=d,r+=d,i+=d}return{b:e,min:i,max:r}}},{key:"__layoutBlock",value:function(t){var e=this.__preLayout(t),i=e.fixedHeight,r=e.w,n=e.h,a=this.currentStyle,o=a.marginLeft,s=a.marginRight,h=a.width;if(this.__width=r,this.__height=i?n:0,o.unit===G.AUTO&&s.unit===G.AUTO&&h.unit!==G.AUTO){var u=this.outerWidth;u<t.w&&this.__offsetX(.5*(t.w-u))}}},{key:"__layoutFlex",value:function(t){this.__layoutBlock(t)}},{key:"__layoutInline",value:function(t){var e=this.__preLayout(t),i=e.fixedWidth,r=e.fixedHeight,n=e.x,a=e.y,o=e.w,s=e.h;this.__width=i?o:n-t.x,this.__height=r?s:a-t.y}},{key:"__preRender",value:function(t){var e=this.sx,i=this.sy,r=this.width,n=this.height,a=this.currentStyle,o=this.computedStyle,s=a.strokeWidth,h=a.fill,u=a.stroke,l=a.strokeDasharray,c=a.strokeLinecap,f=o.borderTopWidth,_=o.borderLeftWidth,d=o.display,p=o.marginTop,v=o.marginLeft,g=o.paddingTop,y=o.paddingRight,m=o.paddingBottom,k=o.paddingLeft,b=o.visibility,x=e+_+v+k,w=i+f+p+g,A=x+.5*r,E=w+.5*n,T=r+k+y,M=n+g+m;return s=s.unit===G.PX?s.value:s.unit===G.PERCENT?s.value*r*.01:0,o.strokeWidth=s,"linear"===u.k||"radial"===u.k?u=this.__gradient(t,x,w,w+T,w+M,T,M,"stroke",u,o):o.stroke=u,"linear"===h.k||"radial"===h.k?h=this.__gradient(t,x,w,w+T,w+M,T,M,"fill",h,o):o.fill=h,{x:e,y:i,originX:x,originY:w,cx:A,cy:E,display:d,stroke:u,strokeWidth:o.strokeWidth=s,strokeDasharray:o.strokeDasharray=l,strokeLinecap:o.strokeLinecap=c,fill:h,visibility:b}}},{key:"render",value:function(t){H(X(r.prototype),"render",this).call(this,t);var e=this.isDestroyed,i=this.computedStyle.display;return e||"none"===i?{isDestroyed:e,display:i}:(t===ee.SVG&&(this.__virtualDom=h({},H(X(r.prototype),"virtualDom",this),{type:"geom"})),this.__preRender(t))}},{key:"__renderAsMask",value:function(t){if(t===ee.CANVAS);else if(t===ee.SVG){this.render(t);var e=this.virtualDom;e.isMask=!0;var i=ie.clone(e.children),x=this.matrixEvent;i.forEach(function(t){var e,i,r=0,n=1,a=t.props;if("rect"===t.tagName){for(var o=0,s=a.length;o<s;o++){var h=Jt(a[o],2),u=h[0],l=h[1];"x"===u?(r=o,e=l):"y"===u&&(n=o,i=l)}var c=C.calPoint([e,i],x);a[r][1]=c[0],a[n][1]=c[1]}else if("circle"===t.tagName||"ellipse"===t.tagName){for(var f=0,_=a.length;f<_;f++){var d=Jt(a[f],2);u=d[0],l=d[1];"cx"===u?(r=f,e=l):"cy"===u&&(n=f,i=l)}var p=C.calPoint([e,i],x);a[r][1]=p[0],a[n][1]=p[1]}else if("polygon"===t.tagName)for(var v=0,g=a.length;v<g;v++){var y=Jt(a[v],2);u=y[0],l=y[1];if("points"===u){a[v][1]=l.replace(/([\d.]+),([\d.]+)/g,function(t,e,i){return C.calPoint([e,i],x).join(",")});break}}else if("path"===t.tagName)for(var m=0,k=a.length;m<k;m++){var b=Jt(a[m],2);u=b[0],l=b[1];if("d"===u){a[m][1]=l.replace(/([\d.]+),([\d.]+)/g,function(t,e,i){return C.calPoint([e,i],x).join(",")});break}}});var r=this.defs.add({tagName:"mask",props:[],children:i});this.__maskId="url(#".concat(r,")")}}},{key:"addGeom",value:function(t,e){e=ie.hash2arr(e),this.virtualDom.children.push({type:"item",tagName:t,props:e})}},{key:"tagName",get:function(){return this.__tagName}},{key:"baseLine",get:function(){return this.__height}},{key:"isMask",get:function(){return this.__isMask}},{key:"maskId",get:function(){return this.__maskId}}],[{key:"getRegister",value:function(t){if(!Dt.hasOwnProperty(t))throw new Error("Geom has not register: ".concat(t));return Dt[t]}},{key:"register",value:function(t,e){if(r.hasRegister(t))throw new Error("Geom has already register: ".concat(t));Dt[t]=e}},{key:"hasRegister",value:function(t){return Dt.hasOwnProperty(t)}}]),r}(),Ht={div:!0,span:!0,img:!0},Gt={span:!0,img:!0},Ut=function(){function v(t,e,i){var r;return f(this,v),(r=_(this,X(v).call(this,t,e))).__children=i||[],r.__flowChildren=[],r.__absChildren=[],r.__lineGroups=[],r}return t(v,Ft),s(v,[{key:"__traverse",value:function(e,i,t){var r=this,n=[];this.__traverseChildren(this.children,n,e,i,t);for(var a=n.length-1;0<a;a--){var o=n[a];if(o instanceof U){var s=n[a-1];s instanceof U?(s.content+=o.content,n.splice(a,1)):a--}}var h=null;n.forEach(function(t){t.__ctx=e,t.__defs=i,h&&((h.__next=t).__prev=h),t.__parent=r,h=t}),this.__children=n}},{key:"__traverseChildren",value:function(t,e,i,r,n){var a=this;if(Array.isArray(t))t.forEach(function(t){a.__traverseChildren(t,e,i,r,n)});else if(t instanceof v||t instanceof at)e.push(t),t.__traverse(i,r,n);else if(t instanceof Xt)e.push(t);else if(!ie.isNil(t)){var o=new U(t);o.__renderMode=n,e.push(o)}}},{key:"__init",value:function(){var e=this,i=this.__style;i.display&&-1!==["flex","block","inline","none"].indexOf(i.display)||(Gt.hasOwnProperty(this.tagName)?i.display="inline":i.display="block"),B.normalize(i,rt.dom),this.children.forEach(function(t){t instanceof Ft||t instanceof at?t.__init():t.__style=i,t instanceof U||"absolute"!==t.style.position?e.__flowChildren.push(t):e.__absChildren.push(t)});var t=this.props.ref;if(t){var r=this.host||this.root;r&&(r.ref[t]=this)}}},{key:"__tryLayInline",value:function(t,e){var i=this.flowChildren,r=this.currentStyle.width;if(r.unit===G.PX)return t-r.value;if(r.unit===G.PERCENT)return t-e*r.value*.01;for(var n=0;n<i.length;n++){if(t<0)return t;var a=i[n];t-=a instanceof Ft?a.__tryLayInline(t,e):a.textWidth}return t}},{key:"__offsetX",value:function(e,i){H(X(v.prototype),"__offsetX",this).call(this,e,i),this.flowChildren.forEach(function(t){t&&t.__offsetX(e,i)})}},{key:"__offsetY",value:function(e,i){H(X(v.prototype),"__offsetY",this).call(this,e,i),this.flowChildren.forEach(function(t){t&&t.__offsetY(e,i)})}},{key:"__calAutoBasis",value:function(a,o,s,t){var h=0,u=0,l=0,e=this.flowChildren,i=this.currentStyle,r=this.computedStyle,n=i.width,c=i.height,f=i.marginLeft,_=i.marginTop,d=i.marginRight,p=i.marginBottom,v=i.paddingLeft,g=i.paddingTop,y=i.paddingRight,m=i.paddingBottom,k=r.borderTopWidth,b=r.borderRightWidth,x=r.borderBottomWidth,w=r.borderLeftWidth,A=a?n:c;if(A.unit===G.PX&&(h=l=A.value,t&&(u=h)),e.forEach(function(t){if(t instanceof Ft||t instanceof at){var e=t.__calAutoBasis(a,o,s,!0),i=e.b,r=e.min,n=e.max;h=Math.max(h,i),u=Math.max(u,r),l=Math.max(l,n)}else l=a?(u=Math.max(t.charWidth,u),Math.max(t.textWidth,l)):(t.__layout({x:0,y:0,w:o,h:s},!0),u=Math.max(u,t.height),Math.max(l,t.height))}),a){var E=b+w+(this.__calMp(f,o)+this.__calMp(d,o)+this.__calMp(v,o)+this.__calMp(y,o));h+=E,l+=E,u+=E}else{var T=k+x+(this.__calMp(_,o)+this.__calMp(p,o)+this.__calMp(g,o)+this.__calMp(m,o));h+=T,l+=T,u+=T}return{b:h,min:u,max:l}}},{key:"__calMp",value:function(t,e){var i=0;return t.unit===G.PX?i+=t.value:t.unit===G.PERCENT&&(t.value*=.01*e,t.unit=G.PX,i+=t.value),i}},{key:"__layoutBlock",value:function(e){var t=this.flowChildren,i=this.currentStyle,r=this.computedStyle,n=this.lineGroups;n.splice(0);var a=r.textAlign,o=this.__preLayout(e),s=o.fixedHeight,h=o.x,u=o.y,l=o.w,c=o.h,f=new Bt(h,u);t.forEach(function(t){t instanceof Ft||t instanceof at?"inline"===t.currentStyle.display?h===e.x?(f.add(t),t.__layout({x:h,y:u,w:l,h:c}),h+=t.outerWidth):(0<=t.__tryLayInline(l-h,l)?t.__layout({x:h,y:u,w:l,h:c}):(n.push(f),f.verticalAlign(),h=e.x,u+=f.height,t.__layout({x:e.x,y:u,w:l,h:c}),f=new Bt(h,u)),h+=t.outerWidth,f.add(t)):(f.size&&(n.push(f),f.verticalAlign(),u+=f.height,f=new Bt(e.x,u)),t.__layout({x:e.x,y:u,w:l,h:c}),h=e.x,u+=t.outerHeight):h===e.x?(f.add(t),t.__layout({x:h,y:u,w:l,h:c}),h+=t.width):(0<=t.__tryLayInline(l-h,l)?t.__layout({x:h,y:u,w:l,h:c}):(n.push(f),f.verticalAlign(),h=e.x,u+=f.height,t.__layout({x:e.x,y:u,w:l,h:c}),f=new Bt(h,u)),h+=t.width,f.add(t))}),f.size&&(n.push(f),f.verticalAlign(),u+=f.height),this.__width=l,this.__height=s?c:u-e.y,-1<["center","right"].indexOf(a)&&n.forEach(function(t){var e=l-t.width;0<e&&t.horizonAlign("center"===a?.5*e:e)}),this.__marginAuto(i,e)}},{key:"__marginAuto",value:function(t,e){if(t.marginLeft.unit===G.AUTO&&t.marginRight.unit===G.AUTO&&t.width.unit!==G.AUTO){var i=this.outerWidth;i<e.w&&this.__offsetX(.5*(e.w-i),!0)}}},{key:"__layoutFlex",value:function(t){var e=this.flowChildren,i=this.currentStyle,r=i.flexDirection,n=i.justifyContent,a=i.alignItems,o=this.__preLayout(t),s=o.fixedWidth,E=o.fixedHeight,T=o.x,M=o.y,P=o.w,S=o.h,O="row"===r,R=[],N=[],C=[],L=[],W=0,I=0,F=0,l=0;e.forEach(function(t){if(t instanceof Ft||t instanceof at){var e=t.currentStyle,i=t.computedStyle,r=e.flexGrow,n=e.flexShrink,a=e.flexBasis;R.push(r),N.push(n),W+=r,I+=n;var o=t.__calAutoBasis(O,P,S),s=o.b,h=o.min,u=o.max;a.unit===G.AUTO?(C.push(u),F+=u):a.unit===G.PX?(i.flexBasis=s=a.value,C.push(s),F+=s):a.unit===G.PERCENT&&(s=i.flexBasis=(O?P:S)*a.value*.01,C.push(s),F+=s),l+=u,L.push(h)}else R.push(0),N.push(1),I+=1,O?(C.push(t.textWidth),F+=t.textWidth,l+=t.textWidth,L.push(t.charWidth)):(t.__layout({x:0,y:0,w:P,h:S},!0),C.push(t.height),F+=t.height,l+=t.height,L.push(t.height))});var B=0,D=(O?P:S)<l;e.forEach(function(t,e){var i,r=N[e],n=R[e];if(D){var a=F-(O?P:S);i=r?C[e]-a*r/I:C[e]}else{var o=(O?P:S)-F;i=n?C[e]+o*n/W:C[e]}if(i=Math.max(i,L[e]),t instanceof Ft||t instanceof at){var s=t.currentStyle,h=t.computedStyle,u=s.display,l=s.flexDirection,c=s.width,f=s.height;if(O?("inline"===u?s.display=h.display="block":"flex"===u&&"column"===l&&E&&f.unit===G.AUTO&&(f.value=S,f.unit=G.PX),t.__layout({x:T,y:M,w:i,h:S})):("inline"===u?s.display=h.display="block":"flex"===u&&"row"===l&&c.unit===G.AUTO&&(c.value=P,c.unit=G.PX),t.__layout({x:T,y:M,w:P,h:i})),D&&r||!D&&n){var _=h.borderTopWidth,d=h.borderRightWidth,p=h.borderBottomWidth,v=h.borderLeftWidth,g=h.marginTop,y=h.marginRight,m=h.marginBottom,k=h.marginLeft,b=h.paddingTop,x=h.paddingRight,w=h.paddingBottom,A=h.paddingLeft;O?t.__width=i-k-y-A-x-v-d:t.__height=i-g-m-b-w-_-p}}else t.__layout({x:T,y:M,w:O?i:P,h:O?S:i});B=O?(T+=t.outerWidth,Math.max(B,t.outerHeight)):(M+=t.outerHeight,Math.max(B,t.outerWidth))});var h=O?P-T+t.x:S-M+t.y;if(!D&&0===W&&0<h){var u=e.length;if("flex-end"===n)for(var c=0;c<u;c++){var f=e[c];O?f.__offsetX(h,!0):f.__offsetY(h,!0)}else if("center"===n)for(var _=.5*h,d=0;d<u;d++){var p=e[d];O?p.__offsetX(_,!0):p.__offsetY(_,!0)}else if("space-between"===n)for(var v=h/(u-1),g=1;g<u;g++){var y=e[g];O?y.__offsetX(v*g,!0):y.__offsetY(v*g,!0)}else if("space-around"===n)for(var m=h/(u+1),k=0;k<u;k++){var b=e[k];O?b.__offsetX(m*(k+1),!0):b.__offsetY(m*(k+1),!0)}}O?(E&&(B=S),M+=B):s&&(B=P),"stretch"===a?e.forEach(function(t){var e=t.computedStyle,i=t.currentStyle,r=e.borderTopWidth,n=e.borderRightWidth,a=e.borderBottomWidth,o=e.borderLeftWidth,s=e.marginTop,h=e.marginRight,u=e.marginBottom,l=e.marginLeft,c=e.paddingTop,f=e.paddingRight,_=e.paddingBottom,d=e.paddingLeft;O?i.height.unit===G.AUTO&&(t.__height=e.height=B-s-u-c-_-r-a):i.width.unit===G.AUTO&&(t.__width=e.width=B-l-h-d-f-n-o)}):"center"===a?e.forEach(function(t){var e=B-t.outerHeight;0<e&&t.__offsetY(.5*e,!0)}):"flex-end"===a&&e.forEach(function(t){var e=B-t.outerHeight;0<e&&t.__offsetY(e,!0)}),this.__width=P,this.__height=E?S:M-t.y,this.__marginAuto(i,t)}},{key:"__layoutInline",value:function(i,r){var n=this,t=this.flowChildren,e=this.computedStyle,a=this.lineGroups;a.splice(0);var o=e.textAlign,s=this.__preLayout(i),h=s.fixedWidth,u=s.fixedHeight,l=s.x,c=s.y,f=s.w,_=s.h,d=l,p=new Bt(l,c);t.forEach(function(t){if(t instanceof Ft||t instanceof at){if("absolute"===t.currentStyle.position)return void n.absChildren.push(t);var e=t.currentStyle.display;if(r&&(t.currentStyle.display="inline"),l===i.x)p.add(t),t.__layout({x:l,y:c,w:f,h:_}),l+=t.outerWidth,d=Math.max(d,l);else 0<=t.__tryLayInline(f-l,f)?t.__layout({x:l,y:c,w:f,h:_}):(a.push(p),p.verticalAlign(),l=i.x,c+=p.height,t.__layout({x:i.x,y:c,w:f,h:_}),p=new Bt(l,c)),l+=t.outerWidth,d=Math.max(d,l),p.add(t);r&&(t.currentStyle.display=e)}else{if(l===i.x)p.add(t),t.__layout({x:l,y:c,w:f,h:_}),l+=t.width,d=Math.max(d,l);else 0<=t.__tryLayInline(f-l,f)?t.__layout({x:l,y:c,w:f,h:_}):(a.push(p),p.verticalAlign(),l=i.x,c+=p.height,t.__layout({x:i.x,y:c,w:f,h:_}),p=new Bt(l,c)),l+=t.width,d=Math.max(d,l),p.add(t)}}),p.size&&(a.push(p),p.verticalAlign(),c+=p.height),this.__width=h?f:d-i.x,this.__height=u?_:c-i.y,-1<["center","right"].indexOf(o)&&a.forEach(function(t){var e=n.__width-t.width;0<e&&t.horizonAlign("center"===o?.5*e:e)})}},{key:"__layoutAbs",value:function(i,A){var E=i.x,T=i.y,t=i.width,e=i.height,r=i.currentStyle,n=i.computedStyle,a=this.isDestroyed,o=this.children,s=this.absChildren,h=r.display,u=n.borderTopWidth,l=n.borderLeftWidth,c=n.marginTop,f=n.marginLeft,_=n.paddingTop,d=n.paddingRight,p=n.paddingBottom,M=n.paddingLeft;if(!a&&"none"!==h){E+=f+l,T+=c+u;var P=t+M+d,S=e+_+p;s.forEach(function(t){var e,i,r,n,a,o,s,h,u,l,c,f=t.currentStyle,_=t.computedStyle,d=f.left,p=f.top,v=f.right,g=f.bottom,y=f.width,m=f.height,k=f.display,b=f.flexDirection;if(void 0!==d&&d.unit!==G.AUTO?(l=!0,_.left=B.calAbsolute(f,"left",d,P)):_.left="auto",void 0!==v&&v.unit!==G.AUTO?(h=!0,_.right=B.calAbsolute(f,"right",v,P)):_.right="auto",void 0!==p&&p.unit!==G.AUTO?(s=!0,_.top=B.calAbsolute(f,"top",p,S)):_.top="auto",void 0!==g&&g.unit!==G.AUTO?(u=!0,_.bottom=B.calAbsolute(f,"bottom",g,S)):_.bottom="auto",l&&h?(e=E+_.left,r=E+P-_.right-e):l&&y.unit!==G.AUTO?(e=E+_.left,r=y.unit===G.PX?y.value:P*y.value*.01):h&&y.unit!==G.AUTO?(r=y.unit===G.PX?y.value:P*y.value*.01,e=E+P-_.right-r):l?e=E+_.left:h?(e=E+P-_.right,a=!0):(e=E+M,y.unit!==G.AUTO&&(r=y.unit===G.PX?y.value:P*y.value*.01)),s&&u)i=T+_.top,n=T+S-_.bottom-i;else if(s&&m.unit!==G.AUTO)i=T+_.top,n=m.unit===G.PX?m.value:S*m.value*.01;else if(u&&m.unit!==G.AUTO)n=m.unit===G.PX?m.value:S*m.value*.01,i=T+S-_.bottom-n;else if(s)i=T+_.top;else if(u)i=T+S-_.bottom,o=!0;else{i=T;for(var x=t.prev;x;){if(x instanceof U||"absolute"!==x.computedStyle.position){i=x.y+x.outerHeight;break}x=x.prev}x||(i=T),m.unit!==G.AUTO&&(n=m.unit===G.PX?m.value:S*m.value*.01)}if(void 0!==r&&(f.width={value:r,unit:G.PX}),void 0!==n&&(f.height={value:n,unit:G.PX}),"inline"===k&&(k="block"),"block"===k&&void 0===r?c=!0:"flex"===k&&("row"===b&&void 0===r?c=!0:"column"===b&&void 0===n&&(c=!0)),c&&(f.display="inline"),a&&o?r=e-E:a?(r=e-E,n=A.h-i):o?(t.__layout({x:e,y:i,w:A.w-e,h:i-T}),r=A.w-e):(r=A.w-e,n=A.h-i),t.__layout({x:e,y:i,w:r,h:n},c),c){var w=0;t.flowChildren.forEach(function(t){w=Math.max(w,t.outerWidth)}),f.width={value:w,unit:G.PX},f.height={value:t.height,unit:G.PX},t.__layout({x:e,y:i,w:r,h:n}),f.display=k}a&&o?(t.__offsetX(-t.outerWidth,!0),t.__offsetY(-t.outerHeight,!0)):a?t.__offsetX(-t.outerWidth,!0):o&&t.__offsetY(-t.outerHeight,!0)}),o.forEach(function(t){if(t instanceof v)t.__layoutAbs(-1<["absolute","relative"].indexOf(t.computedStyle.position)?t:i,A);else if(t instanceof at){var e=t.shadowRoot;e instanceof v&&e.__layoutAbs(e,A)}})}}},{key:"render",value:function(e){H(X(v.prototype),"render",this).call(this,e);var t=this.isDestroyed,i=this.computedStyle,r=i.display,n=i.visibility,a=this.flowChildren,o=this.children;if(!t&&"none"!==r&&"hidden"!==n&&(o.forEach(function(t){t.isMask&&t.__renderAsMask(e)}),a.forEach(function(t){t.isMask||(t instanceof U||"static"===t.computedStyle.position)&&t.__renderByMask(e)}),o.forEach(function(t){t.isMask||(t instanceof Ft||t instanceof at)&&-1<["relative","absolute"].indexOf(t.computedStyle.position)&&t.__renderByMask(e)}),e===ee.SVG)){var s=this.children.slice(0);S(s=s.filter(function(t){return!t.isMask}),function(t,e){if("static"===e.computedStyle.position&&-1<["relative","absolute"].indexOf(t.computedStyle.position))return!0}),this.__virtualDom=h({},H(X(v.prototype),"virtualDom",this),{type:"dom",children:s.map(function(t){return t.virtualDom})})}}},{key:"__destroy",value:function(){H(X(v.prototype),"__destroy",this).call(this),this.children.forEach(function(t){t.__destroy()}),this.children.splice(0),this.flowChildren.splice(0),this.absChildren.splice(0),this.lineGroups.splice(0)}},{key:"tagName",get:function(){return this.__tagName}},{key:"children",get:function(){return this.__children}},{key:"flowChildren",get:function(){return this.__flowChildren}},{key:"absChildren",get:function(){return this.__absChildren}},{key:"lineGroups",get:function(){return this.__lineGroups}},{key:"baseLine",get:function(){var t=this.lineGroups.length;if(t){var e=this.lineGroups[t-1];return e.y-this.y+e.baseLine}return this.y}}],[{key:"isValid",value:function(t){return Ht.hasOwnProperty(t)}}]),v}(),jt={},zt=function(){function C(t,e){var i;if(f(this,C),!(i=_(this,X(C).call(this,t,e,[]))).src||!i.src.trim()){i.__error=!0;var r=u(i).style,n=r.width,a=r.height;n=n||{unit:G.AUTO},a=a||{unit:G.AUTO},n.unit===G.AUTO&&(n.value=32,n.unit=G.PX),a.unit===G.AUTO&&(a.value=32,a.unit=G.PX)}return i}return t(C,Ut),s(C,[{key:"__layout",value:function(t){var r=this;H(X(C.prototype),"__layout",this).call(this,t);var e=this.isDestroyed,i=this.src,n=this.currentStyle,a=n.display,o=n.width,s=n.height;if(!e&&"none"!==a){var h=this.width,u=this.height,l=jt[this.src]=jt[this.src]||{state:0,task:[]},c=function(t){t.success?r.__source=t.source:r.__error=!0,r.__imgWidth=t.width,r.__imgHeight=t.height;var e=nt.REFLOW;o.unit===G.AUTO&&s.unit===G.AUTO?(n.width={value:t.width,unit:G.PX},n.height={value:t.height,unit:G.PX}):o.unit===G.AUTO?n.width={value:u*t.width/t.height,unit:G.PX}:s.unit===G.AUTO?n.height={value:h*t.height/t.width,unit:G.PX}:e=nt.REPAINT;var i=r.root;i&&(i.setRefreshLevel(e),i.addRefreshTask())};2===l.state?c(l):1===l.state?l.task.push(c):0===l.state&&(l.state=1,l.task.push(c),oe.measureImg(i,function(t){l.success=t.success,t.success?(l.width=t.width,l.height=t.height,l.source=t.source):(l.width=32,l.height=32),l.state=2,l.task.forEach(function(t){return t(l)}),l.task.splice(0)}))}}},{key:"__addGeom",value:function(t,e){e=ie.hash2arr(e),this.virtualDom.children.push({type:"item",tagName:t,props:e})}},{key:"render",value:function(t){H(X(C.prototype),"render",this).call(this,t);var e=this.ctx,i=this.sx,r=this.sy,n=this.width,a=this.height,o=this.src,s=this.isDestroyed,h=this.computedStyle,u=h.display,l=h.borderTopWidth,c=h.borderLeftWidth,f=h.marginTop,_=h.marginLeft,d=h.paddingTop,p=h.paddingLeft;if(!s&&"none"!==u){var v=i+_+c+p,g=r+f+l+d;if(this.__error){var y=.02*Math.min(n,a),m="#DDD",k=v+.7*n,b=g+.3*a,x=5*y,w=[[v+.15*n,g+.7*a],[v+.3*n,g+.4*a],[v+.5*n,g+.6*a],[v+.6*n,g+.5*a],[v+.9*n,g+.8*a],[v+.15*n,g+.8*a]];if(t===ee.CANVAS){e.strokeStyle="#CCC",e.lineWidth=y,e.fillStyle=m,e.beginPath(),e.moveTo(v,g),e.lineTo(v+n,g),e.lineTo(v+n,g+a),e.lineTo(v,g+a),e.lineTo(v,g),e.stroke(),e.closePath(),e.beginPath(),e.arc(k,b,x,0,2*Math.PI),e.fill(),e.closePath(),e.beginPath(),e.moveTo(w[0][0],w[0][1]);for(var A=1,E=w.length;A<E;A++){var T=w[A];e.lineTo(T[0],T[1])}e.lineTo(w[0][0],w[0][1]),e.fill(),e.closePath()}else if(t===ee.SVG){this.__addGeom("rect",[["x",v],["y",g],["width",n],["height",a],["stroke","#CCC"],["stroke-width",y],["fill","transparent"]]),this.__addGeom("circle",[["cx",k],["cy",b],["r",x],["fill",m]]);for(var M="",P=0,S=w.length;P<S;P++){var O=w[P];M+="".concat(O[0],",").concat(O[1]," ")}this.__addGeom("polygon",[["points",M],["fill",m]])}}else if(t===ee.CANVAS)this.__source&&e.drawImage(this.__source,v,g,n,a);else if(t===ee.SVG){var R;void 0===this.__imgWidth||n===this.__imgWidth&&a===this.__imgHeight||(R=ae.matrixResize(this.__imgWidth,this.__imgHeight,n,a,v,g,n,a),this.matrix?(this.__matrix=R=re.mergeMatrix(this.__matrix,R),this.__matrixEvent=re.mergeMatrix(this.__matrixEvent,R)):this.__matrixEvent=R,R="matrix("+R.join(",")+")");var N=[["xlink:href",o],["x",v],["y",g],["width",this.__imgWidth||0],["height",this.__imgHeight||0]];R&&N.push(["transform",R]),this.virtualDom.children.push({type:"img",tagName:"image",props:N})}}}},{key:"src",get:function(){return this.props.src}},{key:"baseLine",get:function(){return this.height}}]),C}();function Vt(t,e,i){var r=t.childNodes;!function(t,e,i){for(var r=e.length,n=i.length,a=0,o=t.childNodes;a<Math.min(r,n);a++)Yt(o[a],e[a],i[a]);if(a<r)for(;a<r;a++)_e(t,o,a);else if(a<n)for(;a<n;a++)fe(t,o,a,ie.joinDef(i[a]))}(r[0],e.defs,i.defs),Kt(r[1],e.bb,i.bb,e.bbMask,i.bbMask),qt(t,e,i,!0)}function Yt(t,e,i){if(e.tagName!==i.tagName)t.insertAdjacentHTML("afterend",ie.joinDef(i)),t.parentNode.removeChild(t);else{e.uuid!==i.uuid&&t.setAttribute("id",i.uuid);for(var r={},n=0,a=e.props.length;n<a;n++){var o=Jt(e.props[n],2),s=o[0],h=o[1];r[s]=h}for(var u=0,l=i.props.length;u<l;u++){var c=Jt(i.props[u],2);s=c[0],h=c[1];r.hasOwnProperty(s)?(r[s]!==h&&t.setAttribute(s,h),delete r[s]):t.setAttribute(s,h)}for(var s in r)r.hasOwnProperty(s)&&t.removeAttribute(s);for(var f=t.childNodes,_=e.children.length,d=i.children.length,p=0;p<Math.min(_,d);p++)Zt(t,p,e.children[p],i.children[p]);if(p<_)for(;p<_;p++)_e(t,f,p);else if(p<d)for(;p<d;p++)fe(t,f,p,ie.joinStop(i.stop[p]))}}function $t(t,e,i){"dom"===e.type?"dom"===i.type?qt(t,e,i):"text"===i.type||"img"===i.type?ce(t,i):"geom"===i.type&&function(t,e,i){Kt(t.firstChild,e.bb,i.bb,e.bbMask,i.bbMask),ce(t.lastChild,i.children)}(t,e,i):"text"===e.type?"dom"===i.type||"geom"===i.type||"img"===i.type?ce(t,i):"text"===i.type&&function(t,e,i){for(var r=e.children.length,n=i.children.length,a=0;a<Math.min(r,n);a++)Zt(t,a,e.children[a],i.children[a],!0);var o=t.childNodes;if(a<r)for(;a<r;a++)_e(t,o,a);else if(a<n)for(;a<n;a++)fe(t,o,a,ie.joinVd(i.children[a]))}(t,e,i):"geom"===e.type?"dom"===i.type?function(t,e,i){Kt(t.firstChild,e.bb,i.bb,e.bbMask,i.bbMask),ce(t.lastChild,i.children)}(t,e,i):"text"===i.type||"img"===i.type?ce(t,i):"geom"===i.type&&function(t,e,i){if(!de(e.transform,i.transform)){var r=ie.joinTransform(i.transform);t.getAttribute("transform")!==r&&t.setAttribute("transform",r)}Kt(t.firstChild,e.bb,i.bb,e.bbMask,i.bbMask);for(var n=e.children.length,a=i.children.length,o=0,s=t.lastChild,h=s.childNodes;o<Math.min(n,a);o++)Zt(s,o,e.children[o],i.children[o]);if(o<n)for(;o<n;o++)_e(s,h,o);else if(o<a)for(;o<a;o++)fe(s,h,o,ie.joinVd(i.children[o]))}(t,e,i):"img"===e.type&&("img"===i.type?Qt(t,e,i):ce(t,i))}function qt(t,e,i,r){if(!de(e.transform,i.transform)){var n=ie.joinTransform(i.transform);t.setAttribute("transform",n)}e.opacity!==i.opacity&&t.setAttribute("opacity",e.opacity),e.mask!==i.mask&&(i.mask?t.setAttribute("mask",e.mask):t.removeAttribute("mask")),r||Kt(t.firstChild,e.bb,i.bb,e.bbMask,i.bbMask);for(var a=e.children.length,o=i.children.length,s=0,h=t.lastChild,u=h.childNodes;s<Math.min(a,o);s++)$t(u[s],e.children[s],i.children[s]);if(s<a)for(;s<a;s++)_e(h,u,s);else if(s<o)for(;s<o;s++)fe(h,u,s,ie.joinVd(i.children[s]))}function Kt(t,e,i,r,n){var a=e.length,o=i.length;r!==n&&(n?t.setAttribute("mask",n):t.removeAttribute("mask"));for(var s=0;s<Math.min(a,o);s++)Zt(t,s,e[s],i[s]);var h=t.childNodes;if(s<a)for(;s<a;s++)_e(t,h,s);else if(s<o)for(;s<o;s++)fe(t,h,s,ie.joinVd(i[s]))}function Zt(t,e,i,r,n){var a=t.childNodes;i.tagName!==r.tagName?ce(a[e],r):(Qt(a[e],i,r),n&&i.content!==r.content&&(a[e].textContent=r.content))}function Qt(t,e,i){for(var r={},n=0,a=e.props.length;n<a;n++){var o=Jt(e.props[n],2),s=o[0],h=o[1];r[s]=h}for(var u=0,l=i.props.length;u<l;u++){var c=Jt(i.props[u],2);s=c[0],h=c[1];r.hasOwnProperty(s)?(r[s]!==h&&t.setAttribute(s,h),delete r[s]):t.setAttribute(s,h)}for(var s in r)r.hasOwnProperty(s)&&t.removeAttribute(s)}function ce(t,e){var i;Array.isArray(e)?(i="",e.forEach(function(t){i+=ie.joinVd(t)})):i=ie.joinVd(e),t.insertAdjacentHTML("afterend",i),t.parentNode.removeChild(t)}function fe(t,e,i,r){i>=e.length?t.insertAdjacentHTML("beforeend",r):e[i].insertAdjacentHTML("beforebegin",r)}function _e(t,e,i){e[i]&&t.removeChild(e[i])}function de(t,e){if(t.length!==e.length)return!1;for(var i=0,r=t.length;i<r;i++)if(t[i]!==e[i])return!1;return!0}var pe=function(){function e(t){f(this,e),this.id=t,this.count=0,this.list=[]}return s(e,[{key:"add",value:function(t){return t.uuid="karas-defs-".concat(this.id,"-").concat(this.count++),this.list.push(t),t.uuid}},{key:"clear",value:function(){this.list=[],this.count=0}},{key:"value",get:function(){return this.list}}],[{key:"getInstance",value:function(t){return new e(t)}}]),e}();var ve=0,ge=function(){function n(t,e,i){var r;return f(this,n),(r=_(this,X(n).call(this,t,e,i))).__node=null,r.__mw=0,r.__mh=0,r.__task=[],r.__ref={},$.mix(u(r)),r}return t(n,Ut),s(n,[{key:"__initProps",value:function(){var t=this.props.width;if(!ie.isNil(t)){var e=parseInt(t)||0;0<e&&(this.__width=e)}var i=this.props.height;if(!ie.isNil(i)){var r=parseInt(i)||0;0<r&&(this.__height=r)}}},{key:"__genHtml",value:function(){for(var t,e,i,r="<".concat(this.tagName),n=0,a=this.__props.length;n<a;n++){var o=this.__props[n];r+=(t=o[0],e=o[1],void 0,i=Array.isArray(e)?ie.joinSourceArray(e):ie.stringify(e),"className"===t&&(t="class")," "+t+'="'+ie.encodeHtml(i,!0)+'"')}return r+="></".concat(this.tagName,">")}},{key:"__cb",value:function(t,e){if(("touchmove"!==t.type||this.__touchstartTarget)&&!(t.touches&&1<t.touches.length)){var i=this.node.getBoundingClientRect(),r=i.x,n=i.y,a=i.top,o=i.right;r=r||a||0,n=n||o||0;var s=t.touches?t.touches[0]||{}:t;r=s.clientX-r,n=s.clientY-n,this.__emitEvent({event:t,stopPropagation:function(){this.__stopPropagation=!0,t.stopPropagation()},stopImmediatePropagation:function(){this.__stopPropagation=!0,this.__stopImmediatePropagation=!0,t.stopImmediatePropagation()},preventDefault:function(){t.preventDefault()},x:r,y:n,__hasEmitted:!1},e)}}},{key:"appendTo",value:function(t){if(t=function(t){if(ie.isString(t)&&t){var e=document.querySelector(t);if(!e)throw new Error("can not find dom of selector: "+t);return e}if(!t)throw new Error("can not find dom: "+t);return t}(t),this.__initProps(),this.__refreshLevel=nt.REFLOW,t.nodeName.toUpperCase()===this.tagName.toUpperCase()?(this.__node=t,this.width&&t.setAttribute("width",this.width),this.height&&t.setAttribute("height",this.height)):(this.__node=t.querySelector(this.tagName),this.__node||(t.innerHTML=this.__genHtml(),this.__node=t.querySelector(this.tagName))),this.__uuid=ie.isNil(this.__node.__uuid)?ve++:this.__node.__uuid,this.__defs=this.node.__defs||pe.getInstance(this.__uuid),!this.width||!this.height){var e=window.getComputedStyle(t,null);this.width||(this.__width=parseInt(e.getPropertyValue("width")),t.setAttribute("width",this.width)),this.height||(this.__height=parseInt(e.getPropertyValue("height")),t.setAttribute("height",this.height))}"canvas"===this.tagName?(this.__ctx=this.__node.getContext("2d"),this.__renderMode=ee.CANVAS):"svg"===this.tagName&&(this.__renderMode=ee.SVG);var i=this.style;-1===["flex","block"].indexOf(i.display)&&(i.display="block"),"absolute"===i.position&&(i.position="static");var r=this.renderMode,n=this.ctx;this.__traverse(n,this.__defs,r),this.__traverseCss(this,this.props.css),this.__init(),this.refresh(),this.node.__root?(this.node.__root.__destroy(),delete this.node.__root.__node,delete this.node.__root.__vd):(function(i){["click","dblclick","mousedown","mousemove","mouseup","touchstart","touchmove","touchend","touchcancel"].forEach(function(e){i.addEventListener(e,function(t){i.__root.__cb(t,-1<["touchend","touchcancel","touchmove"].indexOf(e))})})}(this.node),this.node.__uuid=this.__uuid),this.node.__root=this}},{key:"refresh",value:function(i){var r=this,n=this.renderMode,t=this.currentStyle;t.marginTop=t.marginRight=t.marginBottom=t.marginLeft={value:0,unit:G.PX},t.width={value:this.width,unit:G.PX},t.height={value:this.height,unit:G.PX},delete t.transform,t.opacity=1,this.__defs.clear();var a=this.__refreshLevel;this.__refreshLevel=nt.REPAINT,a===nt.REFLOW&&this.__computed(),oe.measureText(function(){if(a===nt.REFLOW?(r.__layout({x:0,y:0,w:r.width,h:r.height}),r.__layoutAbs(r,{x:0,y:0,w:r.width,h:r.height})):r.__repaint(),n===ee.CANVAS&&r.__clear(),r.emit($.KARAS_BEFORE_REFRESH,a),r.render(n),n===ee.SVG){var t=r.virtualDom,e=r.__defs;t.defs=e.value,t=ie.clone(t),r.node.__root?Vt(r.node,r.node.__vd,t):r.node.innerHTML=ie.joinVirtualDom(t),r.node.__vd=t,r.node.__defs=e}r.__task.splice(0).forEach(function(t){ie.isFunction(t)&&t()}),ie.isFunction(i)&&i(),r.emit($.KARAS_REFRESH)})}},{key:"addRefreshTask",value:function(t){var e=this,i=this.task;i.length||ht.nextFrame(function(){i.length&&e.refresh()}),i.push(t)}},{key:"delRefreshTask",value:function(t){if(t)for(var e=this.task,i=0,r=e.length;i<r;i++)if(e[i]===t){e.splice(i,1);break}}},{key:"setRefreshLevel",value:function(t){t>this.__refreshLevel&&(this.__refreshLevel=t)}},{key:"__getImageData",value:function(){return this.ctx.getImageData(0,0,this.width,this.height)}},{key:"__putImageData",value:function(t){this.ctx.putImageData(t,0,0)}},{key:"__clear",value:function(){this.__mw=Math.max(this.__mw,this.width),this.__mh=Math.max(this.__mh,this.height),this.__ctx.setTransform(1,0,0,1,0,0),this.__ctx.clearRect(0,0,this.__mw,this.__mh)}},{key:"node",get:function(){return this.__node}},{key:"renderMode",get:function(){return this.__renderMode}},{key:"task",get:function(){return this.__task}},{key:"ref",get:function(){return this.__ref}}]),n}(),ye=function(){function T(t,e){var i;return f(this,T),(i=_(this,X(T).call(this,t,e))).__x1=i.__y1=0,i.__x2=i.__y2=1,i.__controlA=[],i.__controlB=[],void 0!==i.props.x1&&(i.__x1=parseFloat(i.props.x1)||0),void 0!==i.props.y1&&(i.__y1=parseFloat(i.props.y1)||0),void 0!==i.props.x2&&(i.__x2=parseFloat(i.props.x2)||0),void 0!==i.props.y2&&(i.__y2=parseFloat(i.props.y2)||0),Array.isArray(i.props.controlA)&&(i.__controlA=i.props.controlA),Array.isArray(i.props.controlB)&&(i.__controlB=i.props.controlB),i}return t(T,Xt),s(T,[{key:"render",value:function(t){var e=H(X(T.prototype),"render",this).call(this,t),i=e.isDestroyed,r=e.display,n=e.visibility,a=e.originX,o=e.originY,s=e.stroke,h=e.strokeWidth,u=e.strokeDasharray,l=e.strokeLinecap;if(!i&&"none"!==r&&"hidden"!==n){var c=this.width,f=this.height,_=this.ctx,d=this.x1,p=this.y1,v=this.x2,g=this.y2,y=this.controlA,m=this.controlB;d=a+d*c,p=o+p*f,v=a+v*c,g=o+g*f;var k,b,x,w,A=0;if(2===y.length&&(A++,k=a+y[0]*c,b=o+y[1]*f),2===m.length&&(A+=2,x=a+m[0]*c,w=o+m[1]*f),t===ee.CANVAS)_.strokeStyle=s,_.lineWidth=h,_.lineCap=l,_.setLineDash(u.split(",")),_.beginPath(),_.moveTo(d,p),3===A?_.bezierCurveTo(k,b,x,w,v,g):2===A?_.quadraticCurveTo(x,w,v,g):1===A?_.quadraticCurveTo(k,b,v,g):_.lineTo(v,g),0<h&&_.stroke(),_.closePath();else if(t===ee.SVG){var E=[["d",3===A?"M".concat(d,",").concat(p," C").concat(k,",").concat(b," ").concat(x,",").concat(w," ").concat(v,",").concat(g):2===A?"M".concat(d,",").concat(p," Q").concat(x,",").concat(w," ").concat(v,",").concat(g):1===A?"M".concat(d,",").concat(p," Q").concat(k,",").concat(b," ").concat(v,",").concat(g):"M".concat(d,",").concat(p," L").concat(v,",").concat(g)],["fill","none"],["stroke",s],["stroke-width",h]];u.length&&E.push(["stroke-dasharray",u]),"butt"!==l&&E.push(["stroke-linecap",l]),this.addGeom("path",E)}}}},{key:"x1",get:function(){return this.__x1}},{key:"y1",get:function(){return this.__y1}},{key:"x2",get:function(){return this.__x2}},{key:"y2",get:function(){return this.__y2}},{key:"controlA",get:function(){return this.__controlA}},{key:"controlB",get:function(){return this.__controlB}}]),T}(),me=function(){function B(t,e){var i;return f(this,B),(i=_(this,X(B).call(this,t,e))).__points=[],Array.isArray(i.props.points)&&(i.__points=i.props.points),-1<["TOP_RIGHT","BOTTOM_LEFT","BOTTOM_RIGHT"].indexOf(i.props.origin)?i.__origin=i.props.origin:i.__origin="TOP_LEFT",i.__controls=[],Array.isArray(i.props.controls)&&(i.__controls=i.props.controls),i}return t(B,Xt),s(B,[{key:"render",value:function(t){var e=H(X(B.prototype),"render",this).call(this,t),i=e.isDestroyed,n=e.originX,a=e.originY,r=e.display,o=e.visibility,s=e.stroke,h=e.strokeWidth,u=e.strokeDasharray,l=e.strokeLinecap;if(!i&&"none"!==r&&"hidden"!==o){var c=this.width,f=this.height,_=this.ctx,d=this.points,p=this.controls,v=this.origin;if(!(d.length<2)){for(var g=0,y=d.length;g<y;g++)if(!Array.isArray(d[g])||d[g].length<2)return;var m,k=[],b=[];if("TOP_LEFT"===v?(d.forEach(function(t){k.push([n+t[0]*c,a+t[1]*f])}),p.forEach(function(i){if(!Array.isArray(i)||2!==i.length&&4!==i.length)b.push(null);else{var r=[];i.forEach(function(t,e){0===e||2===e?r.push(n+i[e]*c):r.push(a+i[e]*f)}),b.push(r),m=!0}})):"TOP_RIGHT"===v?(d.forEach(function(t){k.push([n+c-t[0]*c,a+t[1]*f])}),p.forEach(function(i){if(!Array.isArray(i)||2!==i.length&&4!==i.length)b.push(null);else{var r=[];i.forEach(function(t,e){0===e||2===e?r.push(n+c-i[e]*c):r.push(a+i[e]*f)}),b.push(r),m=!0}})):"BOTTOM_LEFT"===v?(d.forEach(function(t){k.push([n+t[0]*c,a+f-t[1]*f])}),p.forEach(function(i){if(!Array.isArray(i)||2!==i.length&&4!==i.length)b.push(null);else{var r=[];i.forEach(function(t,e){0===e||2===e?r.push(n+i[e]*c):r.push(a+f-i[e]*f)}),b.push(r),m=!0}})):"BOTTOM_RIGHT"===v&&(d.forEach(function(t){k.push([n+c-t[0]*c,a+f-t[1]*f])}),p.forEach(function(i){if(!Array.isArray(i)||2!==i.length&&4!==i.length)b.push(null);else{var r=[];i.forEach(function(t,e){0===e||2===e?r.push(n+c-i[e]*c):r.push(a+f-i[e]*f)}),b.push(r),m=!0}})),t===ee.CANVAS){_.strokeStyle=s,_.lineWidth=h,_.lineCap=l,_.setLineDash(u.split(",")),_.beginPath(),_.moveTo(k[0][0],k[0][1]);for(var x=1,w=k.length;x<w;x++){var A=k[x],E=b[x-1];E?4===E.length?_.bezierCurveTo(E[0],E[1],E[2],E[3],A[0],A[1]):_.quadraticCurveTo(E[0],E[1],A[0],A[1]):_.lineTo(A[0],A[1])}0<h&&_.stroke(),_.closePath()}else if(t===ee.SVG){var T,M=[["fill","none"],["stroke",s]];if(m){for(var P="M".concat(k[0][0],",").concat(k[0][1]),S=1,O=k.length;S<O;S++){var R=k[S],N=b[S-1];N?4===N.length?P+="C".concat(N[0],",").concat(N[1]," ").concat(N[2],",").concat(N[3]," ").concat(R[0],",").concat(R[1]):P+="Q".concat(N[0],",").concat(N[1]," ").concat(R[0],",").concat(R[1]):P+="L".concat(R[0],",").concat(R[1])}var C=b[k.length-1];C?4===C.length?P+="C".concat(C[0],",").concat(C[1]," ").concat(C[2],",").concat(C[3]," ").concat(k[0][0],",").concat(k[0][1]):P+="Q".concat(C[0],",").concat(C[1]," ").concat(k[0][0],",").concat(k[0][1]):P+="L".concat(k[0][0],",").concat(k[0][1]),M.push(["d",P]),T="path"}else{for(var L="",W=0,I=k.length;W<I;W++){var F=k[W];W&&(L+=" "),L+="".concat(F[0],",").concat(F[1])}M.push(["points",L]),T="polyline"}u.length&&M.push(["stroke-dasharray",u]),"butt"!==l&&M.push(["stroke-linecap",l]),this.addGeom(T,M)}}}}},{key:"points",get:function(){return this.__points}},{key:"controls",get:function(){return this.__controls}},{key:"origin",get:function(){return this.__origin}}]),B}(),ke=function(){function D(t,e){var i;return f(this,D),(i=_(this,X(D).call(this,t,e))).__points=[],Array.isArray(i.props.points)&&(i.__points=i.props.points),i.__controls=[],Array.isArray(i.props.controls)&&(i.__controls=i.props.controls),i}return t(D,Xt),s(D,[{key:"render",value:function(t){var e=H(X(D.prototype),"render",this).call(this,t),i=e.isDestroyed,n=e.originX,a=e.originY,r=e.display,o=e.visibility,s=e.fill,h=e.stroke,u=e.strokeWidth,l=e.strokeDasharray,c=e.strokeLinecap;if(!i&&"none"!==r&&"hidden"!==o){var f=this.width,_=this.height,d=this.ctx,p=this.points,v=this.controls;if(!(p.length<3)){for(var g=0,y=p.length;g<y;g++)if(!Array.isArray(p[g])||p[g].length<2)return;var m=[];p.forEach(function(t){m.push([n+t[0]*f,a+t[1]*_])});var k,b=[];if(v.forEach(function(i){if(!Array.isArray(i)||2!==i.length&&4!==i.length)b.push(null);else{var r=[];i.forEach(function(t,e){0===e||2===e?r.push(n+i[e]*f):r.push(a+i[e]*_)}),b.push(r),k=!0}}),t===ee.CANVAS){d.strokeStyle=h,d.lineWidth=u,d.fillStyle=s,d.lineCap=c,d.setLineDash(l.split(",")),d.beginPath(),d.moveTo(m[0][0],m[0][1]);for(var x=1,w=m.length;x<w;x++){var A=m[x],E=b[x-1];E?4===E.length?d.bezierCurveTo(E[0],E[1],E[2],E[3],A[0],A[1]):d.quadraticCurveTo(E[0],E[1],A[0],A[1]):d.lineTo(A[0],A[1])}var T=b[m.length-1];T?4===T.length?d.bezierCurveTo(T[0],T[1],T[2],T[3],m[0][0],m[0][1]):d.quadraticCurveTo(T[0],T[1],m[0][0],m[0][1]):d.lineTo(m[0][0],m[0][1]),d.fill(),0<u&&d.stroke(),d.closePath()}else if(t===ee.SVG){var M,P=[];if(k){for(var S="M".concat(m[0][0],",").concat(m[0][1]),O=1,R=m.length;O<R;O++){var N=m[O],C=b[O-1];C?4===C.length?S+="C".concat(C[0],",").concat(C[1]," ").concat(C[2],",").concat(C[3]," ").concat(N[0],",").concat(N[1]):S+="Q".concat(C[0],",").concat(C[1]," ").concat(N[0],",").concat(N[1]):S+="L".concat(N[0],",").concat(N[1])}var L=b[m.length-1];L?4===L.length?S+="C".concat(L[0],",").concat(L[1]," ").concat(L[2],",").concat(L[3]," ").concat(m[0][0],",").concat(m[0][1]):S+="Q".concat(L[0],",").concat(L[1]," ").concat(m[0][0],",").concat(m[0][1]):S+="L".concat(m[0][0],",").concat(m[0][1]),P.push(["d",S]),M="path"}else{for(var W="",I=0,F=m.length;I<F;I++){var B=m[I];W+="".concat(B[0],",").concat(B[1]," ")}P.push(["points",W]),M="polygon"}P=P.concat([["fill",s],["stroke",h],["stroke-width",u]]),l.length&&P.push(["stroke-dasharray",l]),"butt"!==c&&P.push(["stroke-linecap",c]),this.addGeom(M,P)}}}}},{key:"points",get:function(){return this.__points}},{key:"controls",get:function(){return this.__controls}}]),D}(),be=.5*Math.PI;function xe(t,e,i,r){return 0<=(r%=360)&&r<90?[t+Math.sin(r*Math.PI/180)*i,e-Math.cos(r*Math.PI/180)*i]:90<=r&&r<180?[t+Math.cos((r-90)*Math.PI/180)*i,e+Math.sin((r-90)*Math.PI/180)*i]:180<=r&&r<270?[t-Math.cos((270-r)*Math.PI/180)*i,e+Math.sin((270-r)*Math.PI/180)*i]:[t-Math.sin((360-r)*Math.PI/180)*i,e-Math.cos((360-r)*Math.PI/180)*i]}var we=function(){function S(t,e){var i;return f(this,S),(i=_(this,X(S).call(this,t,e))).__begin=0,i.__end=0,i.props.begin&&(i.__begin=parseFloat(i.props.begin),isNaN(i.begin)&&(i.__begin=0)),i.props.end&&(i.__end=parseFloat(i.props.end),isNaN(i.end)&&(i.__end=0)),i.__r=1,i.props.r&&(i.__r=parseFloat(i.props.r),isNaN(i.r)&&(i.__r=1)),i.__edge=!1,void 0!==i.props.edge&&(i.__edge=!!i.props.edge),i.__closure=!1,void 0!==i.props.closure&&(i.__closure=!!i.props.closure),i}return t(S,Xt),s(S,[{key:"render",value:function(t){var e=H(X(S.prototype),"render",this).call(this,t),i=e.isDestroyed,r=e.cx,n=e.cy,a=e.display,o=e.visibility,s=e.fill,h=e.stroke,u=e.strokeWidth,l=e.strokeDasharray,c=e.strokeLinecap;if(!i&&"none"!==a&&"hidden"!==o){var f=this.width,_=this.height,d=this.ctx,p=this.begin,v=this.end,g=this.r,y=this.edge,m=this.closure;if(p!==v){var k,b,x,w,A=Jt(xe(r,n,g*=.5*Math.min(f,_),p),2);k=A[0],b=A[1];var E=Jt(xe(r,n,g,v),2);x=E[0],w=E[1];var T=180<v-p?1:0;if(t===ee.CANVAS)d.strokeStyle=h,d.lineWidth=u,d.fillStyle=s,d.lineCap=c,d.setLineDash(l.split(",")),d.beginPath(),d.arc(r,n,g,p*Math.PI/180-be,v*Math.PI/180-be),y?(T&&m||d.lineTo(r,n),d.lineTo(k,b),0<u&&d.stroke()):(0<u&&d.stroke(),T&&m||d.lineTo(r,n),d.lineTo(k,b)),d.fill(),d.closePath();else if(t===ee.SVG)if(y){var M=[["d",m?"M".concat(k," ").concat(b," A").concat(g," ").concat(g," 0 ").concat(T," 1 ").concat(x," ").concat(w," z"):"M".concat(r," ").concat(n," L").concat(k," ").concat(b," A").concat(g," ").concat(g," 0 ").concat(T," 1 ").concat(x," ").concat(w," z")],["fill",s],["stroke",h],["stroke-width",u]];l.length&&M.push(["stroke-dasharray",l]),"butt"!==c&&M.push(["stroke-linecap",c]),this.addGeom("path",M)}else if(this.addGeom("path",[["d",m?"M".concat(k,",").concat(b," A").concat(g," ").concat(g," 0 ").concat(T," 1 ").concat(x,",").concat(w," z"):"M".concat(r,",").concat(n," L").concat(k,",").concat(b," A").concat(g," ").concat(g," 0 ").concat(T," 1 ").concat(x,",").concat(w," z")],["fill",s]]),0<u){var P=[["d","M".concat(k,",").concat(b," A").concat(g,",").concat(g," 0 ").concat(T," 1 ").concat(x,",").concat(w)],["fill","transparent"],["stroke",h],["stroke-width",u]];l.length&&P.push(["stroke-dasharray",l]),"butt"!==c&&P.push(["stroke-linecap",c]),this.addGeom("path",P)}}}}},{key:"begin",get:function(){return this.__begin}},{key:"end",get:function(){return this.__end}},{key:"r",get:function(){return this.__r}},{key:"edge",get:function(){return this.__edge}},{key:"closure",get:function(){return this.__closure}}]),S}(),Ae=function(){function k(t,e){var i;return f(this,k),(i=_(this,X(k).call(this,t,e))).__rx=0,i.props.rx&&(i.__rx=parseFloat(i.props.rx),isNaN(i.rx)&&(i.__rx=0)),i.__ry=0,i.props.ry&&(i.__ry=parseFloat(i.props.ry),isNaN(i.ry)&&(i.__ry=0)),i}return t(k,Xt),s(k,[{key:"render",value:function(t){var e=H(X(k.prototype),"render",this).call(this,t),i=e.isDestroyed,r=e.originX,n=e.originY,a=e.display,o=e.visibility,s=e.fill,h=e.stroke,u=e.strokeWidth,l=e.strokeDasharray,c=e.strokeLinecap;if(!i&&"none"!==a&&"hidden"!==o){var f=this.width,_=this.height,d=this.ctx,p=this.rx,v=this.ry;if(p=Math.min(p,.5),v=Math.min(v,.5),p*=f,v*=_,t===ee.CANVAS){if(d.strokeStyle=h,d.lineWidth=u,d.fillStyle=s,d.lineCap=c,d.setLineDash(l.split(",")),d.beginPath(),0===p&&0===v)d.moveTo(r,n),d.lineTo(r+f,n),d.lineTo(r+f,n+_),d.lineTo(r,n+_),d.lineTo(r,n);else{var g=.5522848*p,y=.5522848*v;d.moveTo(r+p,n),d.lineTo(r+f-p,n),d.bezierCurveTo(r+f+g-p,n,r+f,n+v-y,r+f,n+v),d.lineTo(r+f,n+_-v),d.bezierCurveTo(r+f,n+_+y-v,r+f+g-p,n+_,r+f-p,n+_),d.lineTo(r+p,n+_),d.bezierCurveTo(r+p-g,n+_,r,n+_+y-v,r,n+_-v),d.lineTo(r,n+v),d.bezierCurveTo(r,n+v-y,r+p-g,n,r+p,n)}d.fill(),0<u&&d.stroke(),d.closePath()}else if(t===ee.SVG){var m=[["x",r],["y",n],["width",f],["height",_],["fill",s],["stroke",h],["stroke-width",u]];p&&m.push(["rx",p]),v&&m.push(["ry",v]),l.length&&m.push(["stroke-dasharray",l]),"butt"!==c&&m.push(["stroke-linecap",c]),this.addGeom("rect",m)}}}},{key:"rx",get:function(){return this.__rx}},{key:"ry",get:function(){return this.__ry}}]),k}(),Ee=function(){function g(t,e){var i;return f(this,g),(i=_(this,X(g).call(this,t,e))).__r=1,i.props.r&&(i.__r=parseFloat(i.props.r),isNaN(i.r)&&(i.__r=1)),i}return t(g,Xt),s(g,[{key:"render",value:function(t){var e=H(X(g.prototype),"render",this).call(this,t),i=e.isDestroyed,r=e.cx,n=e.cy,a=e.display,o=e.visibility,s=e.fill,h=e.stroke,u=e.strokeWidth,l=e.strokeDasharray,c=e.strokeLinecap;if(!i&&"none"!==a&&"hidden"!==o){var f=this.width,_=this.height,d=this.ctx,p=this.r;if(p*=.5*Math.min(f,_),t===ee.CANVAS)d.strokeStyle=h,d.lineWidth=u,d.fillStyle=s,d.lineCap=c,d.setLineDash(l.split(",")),d.beginPath(),d.arc(r,n,p,0,2*Math.PI),d.fill(),0<u&&d.stroke(),d.closePath();else if(t===ee.SVG){var v=[["cx",r],["cy",n],["r",p],["fill",s],["stroke",h],["stroke-width",u]];l.length&&v.push(["stroke-dasharray",l]),"butt"!==c&&v.push(["stroke-linecap",c]),this.addGeom("circle",v)}}}},{key:"r",get:function(){return this.__r}}]),g}(),Te=function(){function k(t,e){var i;return f(this,k),(i=_(this,X(k).call(this,t,e))).__rx=1,i.props.rx&&(i.__rx=parseFloat(i.props.rx),isNaN(i.rx)&&(i.__rx=1)),i.__ry=1,i.props.ry&&(i.__ry=parseFloat(i.props.ry),isNaN(i.ry)&&(i.__ry=1)),i}return t(k,Xt),s(k,[{key:"render",value:function(t){var e=H(X(k.prototype),"render",this).call(this,t),i=e.isDestroyed,r=e.cx,n=e.cy,a=e.display,o=e.visibility,s=e.fill,h=e.stroke,u=e.strokeWidth,l=e.strokeDasharray,c=e.strokeLinecap;if(!i&&"none"!==a&&"hidden"!==o){var f=this.width,_=this.height,d=this.ctx,p=this.rx,v=this.ry;if(p*=.5*f,v*=.5*_,t===ee.CANVAS){if(d.strokeStyle=h,d.lineWidth=u,d.fillStyle=s,d.lineCap=c,d.setLineDash(l.split(",")),d.beginPath(),d.ellipse)d.ellipse(r,n,p,v,0,0,2*Math.PI);else{var g=.5522848*p,y=.5522848*v;d.moveTo(r-p,n),d.bezierCurveTo(r-p,n-y,r-g,n-v,r,n-v),d.bezierCurveTo(r+g,n-v,r+p,n-y,r+p,n),d.bezierCurveTo(r+p,n+y,r+g,n+v,r,n+v),d.bezierCurveTo(r-g,n+v,r-p,n+y,r-p,n)}d.fill(),0<u&&d.stroke(),d.closePath()}else if(t===ee.SVG){var m=[["cx",r],["cy",n],["rx",p],["ry",v],["fill",s],["stroke",h],["stroke-width",u]];l.length&&m.push(["stroke-dasharray",l]),"butt"!==c&&m.push(["stroke-linecap",c]),this.addGeom("ellipse",m)}}}},{key:"rx",get:function(){return this.__rx}},{key:"ry",get:function(){return this.__ry}}]),k}();function Me(t,e,i,r){return Math.atan((r-e)/(i-t))}function Pe(t){var e=Math.sin(t),i=Math.cos(t),r=C.identity();return r[0]=r[5]=i,r[1]=e,r[4]=-e,r}var Se={transform:function(t,e){var i=Jt(t,6),r=i[0],n=i[1],a=i[2],o=i[3],s=i[4],h=i[5],u=Jt(e,6),l=u[0],c=u[1],f=u[2],_=u[3],d=u[4],p=u[5],v=l-r,g=f-a;l-=v,c-=g,f-=v,_-=g,d-=v,p-=g;var y=C.identity(),m=Me(r,n,a,o),k=Pe(-m);y=C.multiply(k,y);var b=Math.sqrt(Math.pow(a-r,2)+Math.pow(o-n,2)),x=Math.sqrt(Math.pow(f-l,2)+Math.pow(_-c,2))/b;(k=C.identity())[0]=k[5]=x,y=C.multiply(k,y),k=Pe(-(m=Me(l,c,f,_)));var w=Jt(C.calPoint([f,_],C.t43(k)),2),A=w[0],E=w[1],T=Jt(C.calPoint([d,p],C.t43(k)),2),M=T[0],P=T[1],S=Math.atan((A-M)/(P-E));x=P/C.calPoint([s,h],C.t43(y))[1],(k=C.identity())[5]=x,y=C.multiply(k,y);var O=Jt(C.calPoint([s,h],C.t43(y)),2),R=O[0],N=O[1];return m=Math.atan((M-R)/N),(k=C.identity())[4]=Math.tan(m),y=C.multiply(k,y),k=Pe(-S),y=C.multiply(k,y),(k=C.identity())[12]=v,k[13]=g,y=C.multiply(k,y),C.t43(y)}},Oe={matrix:C,tar:Se};Xt.register("$line",ye),Xt.register("$polyline",me),Xt.register("$polygon",ke),Xt.register("$sector",we),Xt.register("$rect",Ae),Xt.register("$circle",Ee),Xt.register("$ellipse",Te);var Re={render:function(t,e){if(!(t instanceof ge))throw new Error("render root muse be canvas or svg");return e&&t.appendTo(e),t},createVd:function(t,e,i){if(-1<["canvas","svg"].indexOf(t))return new ge(t,e,i);if(Ut.isValid(t))return"img"===t?new zt(t,e):new Ut(t,e,i);throw new Error("can not use marker: "+t)},createGm:function(t,e){return new(Xt.getRegister(t))(t,e)},createCp:function(t,e,i){return new t(e,i)},parse:function(t,e){var i={animate:[]},r=function e(i,t,r){if(ie.isBoolean(t)||ie.isNil(t)||ie.isString(t)||ie.isNumber(t))return t;var n,a,o=t.tagName,s=t.props,h=void 0===s?{}:s,u=t.children,l=void 0===u?[]:u,c=t.animate;return c&&(n={animate:c},r.animate.push(n)),a="$"===o.charAt(0)?i.createGm(o,h):i.createVd(o,h,l.map(function(t){return e(i,t,r)})),n&&(n.target=a),a}(this,t=ie.clone(t),i);return this.render(r,e),i.animate.forEach(function(t){var e=t.target,i=t.animate;Array.isArray(i)?i.forEach(function(t){e.animate(t.value,t.options)}):e.animate(i.value,i.options)}),r},Root:ge,Dom:Ut,Img:zt,Geom:Xt,mode:ee,Component:at,Event:$,sort:S,util:ie,inject:oe,css:B,frame:ht,easing:kt,level:nt,math:Oe};return"undefined"!=typeof window&&(window.karas=Re),Re});
//# sourceMappingURL=index.min.js.map
